(()=>{"use strict";function e(e,t,i,n){return new(i||(i=Promise))((function(s,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}function t(e,t){var i,n,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((s=(s=r.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create,Object.create,new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");var i=new Error("request for lock canceled");const n=function(){function n(e,t){if(void 0===t&&(t=i),this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}return n.prototype.acquire=function(){var e=this,t=this.isLocked(),i=new Promise((function(t,i){return e._queue.push({resolve:t,reject:i})}));return t||this._dispatch(),i},n.prototype.runExclusive=function(i){return e(this,void 0,void 0,(function(){var e,n,s;return t(this,(function(t){switch(t.label){case 0:return[4,this.acquire()];case 1:e=t.sent(),n=e[0],s=e[1],t.label=2;case 2:return t.trys.push([2,,4,5]),[4,i(n)];case 3:return[2,t.sent()];case 4:return s(),[7];case 5:return[2]}}))}))},n.prototype.waitForUnlock=function(){return e(this,void 0,void 0,(function(){var e=this;return t(this,(function(t){return this.isLocked()?[2,new Promise((function(t){return e._waiters.push({resolve:t})}))]:[2,Promise.resolve()]}))}))},n.prototype.isLocked=function(){return this._value<=0},n.prototype.release=function(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){var e=this._currentReleaser;this._currentReleaser=void 0,e()}},n.prototype.cancel=function(){var e=this;this._queue.forEach((function(t){return t.reject(e._cancelError)})),this._queue=[]},n.prototype._dispatch=function(){var e=this,t=this._queue.shift();if(t){var i=!1;this._currentReleaser=function(){i||(i=!0,e._value++,e._resolveWaiters(),e._dispatch())},t.resolve([this._value--,this._currentReleaser])}},n.prototype._resolveWaiters=function(){this._waiters.forEach((function(e){return e.resolve()})),this._waiters=[]},n}(),s=function(){function i(e){this._semaphore=new n(1,e)}return i.prototype.acquire=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,this._semaphore.acquire()];case 1:return[2,e.sent()[1]]}}))}))},i.prototype.runExclusive=function(e){return this._semaphore.runExclusive((function(){return e()}))},i.prototype.isLocked=function(){return this._semaphore.isLocked()},i.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},i.prototype.release=function(){this._semaphore.release()},i.prototype.cancel=function(){return this._semaphore.cancel()},i}(),o=e=>null==e||"object"==typeof e&&0===Object.keys(e).length||!(!Array.isArray(e)||0!==e.length)||"string"==typeof e&&0===e.trim().length,r=document,a=(e,...t)=>{const i=r.createElement(e);return l(i,...t),i},l=(e,...t)=>{const i=d(e);for(const e of t)o(e)||i?.classList.add(e);return i},c=(e,...t)=>{const i=d(e);for(const e of t)o(e)||i?.classList.remove(e);return i},d=e=>e instanceof HTMLElement?e:r.querySelector(e),h={on(e,t){if(this._eventHandlers||(this._eventHandlers={}),"string"==typeof e)this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push(t);else if("object"==typeof e)for(let t in e){let i=t,n=e[t];this._eventHandlers[i]||(this._eventHandlers[i]=[]),this._eventHandlers[i].push(n)}return this},off(e,t){if(!this._eventHandlers)return;if(!e&&!t)return void(this._eventHandlers={});if(e&&!t)return void delete this._eventHandlers[e];let i=this._eventHandlers?.[e];if(i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}return this},unbind(...e){this.off(...e)},trigger(e,...t){if(this._eventHandlers?.[e])if("string"==typeof e)this._eventHandlers[e].forEach((e=>e.apply(this,t)));else if("object"==typeof e)for(let t in e){let i=t,n=e[t];this._eventHandlers[i].forEach((e=>e.apply(this,n)))}}},u={collection:new Set,add(e){this.collection.add(e)},delete(e){this.collection.delete(e)},get(e){return Array.from(this.collection).find((t=>t.id==e))},getAll(){return this.collection},hasSingleton(){return!!Array.from(this.collection).find((e=>1==e.singleton))}},p=(e,t)=>{if("show"==t){if(u.hasSingleton()&&1!=e.singleton)return;1==e.singleton&&u.getAll().forEach((e=>{e.close()})),u.add(e)}else"hide"==t&&(u.delete(e),1!=e.persistent&&e.remove())},g={promisifyModal(e){const t="string"==typeof e?d(e):e;if(!t)return null;if(1==t.promisify)return t;const i=t.querySelectorAll("[data-modal-btn]");return i.forEach((e=>{e.addEventListener("click",(()=>{t.resolve?.(e.dataset.modalBtn),e.dataset.modalClose&&"manual"==e.dataset.modalClose||t.hide()})),e.setText=t=>(e.innerText=t,e),e.setColor=t=>{switch(t){case"blue":c("$btn","btn-red","btn-white"),l("$btn","btn-blue");break;case"red":c("$btn","btn-blue","btn-white"),l("$btn","btn-red");break;case"white":c("$btn","btn-red","btn-blue"),l("$btn","btn-white")}return e}})),t.getBtn=e=>{const t=Array.from(i).filter((t=>t.dataset.modalBtn==e));return t?.pop()},t.show=e=>(t.style.display="block",t.onshow?.(),t.onswitch?.(t,"show"),e?.(),new Promise(((e,i)=>{t.resolve=e,t.reject=i,t.close=()=>{e("CLOSE"),t.hide()}}))),t.hide=()=>{t.style.display="none",i.forEach((e=>{e.onclick=void 0})),t.onhide?.(),t.onswitch?.(t,"hide")},t.close=t.hide,t.enableBtn=e=>{const i=t.querySelector('[data-modal-btn="'+e+'"]');i&&(i.disabled=!1)},t.disableBtn=e=>{const i=t.querySelector('[data-modal-btn="'+e+'"]');i&&(i.disabled=!0)},t.on=(e,i)=>{switch(e){case"show":t.onshow=i;break;case"hide":t.onhide=i;break;case"switch":t.onswitch=i}return t},t.off=e=>{switch(e){case"show":t.onshow=null;break;case"hide":t.onhide=null;break;case"switch":t.onswitch=null}return t},t.promisify=!0,t},buildTemplate(e){const t=a("div","modal","top-front"),i=a("div","modalWrap");t.appendChild(i);const n=a("div","modal_content");i.appendChild(n);const s=a("div","modalTitle");s.style.display="none",n.appendChild(s),t.getTitleDiv=()=>s;const o=a("div","modalBody","flex-direction-column");o.style.display="none",n.appendChild(o),t.getMsgDiv=()=>o;const r=a("div","modalInfo");r.style.display="none",n.appendChild(r),t.getDetailDiv=()=>r;const c=a("div","modalBtnDiv");return"vertical"==e&&l(c,"flex-direction-column"),n.appendChild(c),t.addBtn=e=>{c.appendChild(e)},t.singleton=!1,t.addBlackout=()=>{t.style.background="rgba(0,0,0,0.5)"},t.removeBlackout=()=>{t.style.background=""},t},buildButton(e){switch(e){case"OK":const t=a("button","btn","btn-md","btn-blue");return t.innerHTML="확 인",t.dataset.modalBtn="OK",t;case"CLOSE":const i=a("button","btn","btn-md","btn-silver");return i.innerHTML="닫 기",i.dataset.modalBtn="CLOSE",i;case"CANCEL":const n=a("button","btn","btn-md","btn-silver");return n.innerHTML="취 소",n.dataset.modalBtn="CANCEL",n;case"DELETE":const s=a("button","btn","btn-md","btn-red");return s.innerHTML="삭 제",s.dataset.modalBtn="DELETE",s;default:const{isPrimary:o,key:r,text:c}=e,d=a("button","btn","btn-md");return l(d,1==o?"btn-blue":"btn-blue-border"),d.innerHTML=c,d.dataset.modalBtn=r,d}},buildModal(e={}){const{btnList:t,direction:i="horizontal",target:n=d("body")}=e,s=this.buildTemplate(i);return t.forEach((e=>s.addBtn(this.buildButton(e)))),s.setTitle=e=>{const t=s.getTitleDiv();t.style.display="",t.innerHTML=e},s.setMsg=e=>{const t=a("div","commonMent");t.innerHTML=e;const i=s.getMsgDiv();i.querySelector(".commonMent")?.remove(),i.style.display="",i.appendChild(t)},s.setDetail=(...e)=>{if(0==e.length)return;const t=a("ul","modalInfo");for(const i of e){const e=a("li");e.innerHTML=i.message?i.message:i,t.appendChild(e)}const i=s.getDetailDiv();i.style.display="",i.appendChild(t)},s.setErrorInfo=(...e)=>{const t=a("ul","modalInfo");for(const i of e){const e=a("li");e.innerHTML=i.message?i.message:i,t.appendChild(e)}s.setDetail(t)},s.persistent=!1,n.appendChild(s),this.promisifyModal(s).on(p)}},f={animations:{doubleBounce:()=>{const e=a("div","sk-double-bounce"),t=a("div","sk-child","sk-double-bounce1"),i=a("div","sk-child","sk-double-bounce2");return e.appendChild(t),e.appendChild(i),e},pulse:()=>a("div","sk-spinner","sk-spinner-pulse"),spinner:()=>{const e=a("div","sk-fading-circle");for(let t=0;t<12;t++){const i=a("div","sk-circle","sk-circle"+(t+1));e.appendChild(i)}return e},foldingCube:()=>{const e=a("div","sk-folding-cube"),t=a("div","sk-cube","sk-cube1"),i=a("div","sk-cube","sk-cube2"),n=a("div","sk-cube","sk-cube3"),s=a("div","sk-cube","sk-cube4");return e.appendChild(t),e.appendChild(i),e.appendChild(s),e.appendChild(n),e}},promisifyModal(e){const t="string"==typeof e?d(e):e;if(!t)return null;if(1==t.promisify)return t;const i=t.querySelectorAll("[data-modal-btn]");return t.show=()=>(l(t,"visible"),c(t,"hidden"),t.onshow?.(),t.onswitch?.(t,"show"),new Promise(((e,n)=>{i.forEach((i=>{i.onclick=()=>{e(i.dataset.modalBtn),t.hide()}})),t.close=()=>{e("CLOSE"),t.hide()}}))),t.hide=()=>{c(t,"visible"),l(t,"hidden"),i.forEach((e=>{e.onclick=void 0})),t.onhide?.(),t.onswitch?.(t,"hide")},t.close=t.hide,t.on=(e,i)=>{switch(e){case"show":t.onshow=i;break;case"hide":t.onhide=i;break;case"switch":t.onswitch=i}return t},t.off=e=>{switch(e){case"show":t.onshow=null;break;case"hide":t.onhide=null;break;case"hide":t.onswitch=null}return t},t.promisify=!0,t},buildTemplate(){const e=a("div","modal","loading-modal","visible"),t=a("div","loading-info-box","m-2");e.appendChild(t);const i=a("div","loading-animation");t.appendChild(i);const n=a("div","loading-text");return t.appendChild(n),e.setAnimation=t=>{const n=this.animations[t]?.();i.appendChild(n),e.animation=n},e.setPosition=t=>{e.style.position=t},e.setText=e=>{n.innerHTML=e},e.setTextColor=e=>{n.style.color=e},e.setAnimationColor=t=>{e.animation.setColor(t)},e.setBackgroundColor=t=>{e.style.backgroundColor=t},e.setBackgroundOpacity=t=>{e.style.opacity=t},e.persistent=!1,e.addBlackout=()=>{e.style.background="rgba(0,0,0,0.5)",c(i,"blackout")},e.removeBlackout=()=>{e.style.background="none",l(i,"blackout")},e},buildLoading(e={}){const{position:t="auto",text:i="",color:n="#fff",opacity:s="0.7",backgroundColor:o="rgb(0,0,0)",animation:r="doubleBounce",target:a=d("body"),blackout:l=!0,isModal:h=!0}=e,g=u.get("loadingModal")?u.get("loadingModal"):this.buildTemplate();return g.setPosition(t),g.setAnimation(r),g.setText(i),g.setTextColor(n),g.setBackgroundColor(o),g.setBackgroundOpacity(s),l?g.addBlackout():g.removeBlackout(),h||c(g,"modal"),a.appendChild(g),this.promisifyModal(g).on("switch",p)}},m={init(){var e;this.target=d("body"),this.persistentMap=new Map,((e=".modal")instanceof HTMLElement?e:r.querySelectorAll(e)).forEach(((e,t)=>{const i=g.promisifyModal(e)?.on("switch",p);if(i){i.persistent=!0;const e=i.id?i.id:"modal"+t;this.persistentMap.set(e,i),i.hide()}}))},persistentModal(e){return this.persistentMap.get(e)},info(e={}){const{id:t="infoModal",title:i="알 림",detail:n,msg:s,singleton:o=!1}=e;console.log("info modal","title",i,"msg",s,"detail",n);const r=g.buildModal({btnList:["OK"]});return r.id=t,r.singleton=o,i&&r.setTitle(i),s&&r.setMsg(s),n&&r.setDetail(...n),r},confirm(e={}){const{id:t="confirmModal",title:i,msg:n,detail:s,delMode:o=!1,singleton:r=!1}=e,a=1==o?["CANCEL","DELETE"]:["CANCEL","OK"],l=g.buildModal({btnList:a});return l.id=t,l.singleton=r,i&&l.setTitle(i),n&&l.setMsg(n),s&&l.setDetail(...s),l},select(e={}){const{id:t="selectModal",title:i,msg:n,select:s=[],singleton:o=!1,direction:r="vertical"}=e;s.push("CLOSE");const a=g.buildModal({btnList:s,direction:r});return a.id=t,a.singleton=o,i&&a.setTitle(i),n&&a.setMsg(n),a},error(e={}){const{id:t="errorModal",singleton:i=!1,response:{status:n,responseText:s,message:o,detail:r,error:a}}=e,l=g.buildModal({btnList:["OK"]});switch(l.id=t,l.singleton=i,n){case 0:l.setTitle("연결 실패"),l.setMsg("서버와의 연결이 끊어졌습니다. 인터넷 연결 상태를 확인하고 다시 시도해주세요."),l.onhide=e=>{location.href="/login"},l.singleton=!0;break;case 500:l.setTitle("500 Internal Server Error"),l.setMsg("서버에서 요청을 처리할 수 없습니다. 지속적으로 발생할 경우 관리자에게 문의해주세요.");break;case 400:l.setTitle("400 Bad Request"),l.setMsg("요청문에 오류가 있거나 서버가 요청을 이해하지 못했습니다. 지속적으로 발생할 경우 관리자에게 문의해주세요.");break;case 422:l.setTitle("422 Unprocessable Entity"),l.setMsg("요청에 대해 응답할 수 없습니다. 지속적으로 발생할 경우 관리자에게 문의해주세요.");break;case 401:l.setTitle("401 Unauthorized"),l.setMsg(s||"인증되지 않은 사용자의 요청입니다. 로그인 페이지로 이동합니다."),l.onhide=e=>{location.href="/login"},l.singleton=!0;break;case 403:l.setTitle("403 Forbidden"),l.setMsg("요청에 대한 권한이 없습니다.");break;case 404:l.setTitle("404 Not Found"),l.setMsg("요청한 페이지를 찾을 수 없습니다. 지속적으로 발생할 경우 관리자에게 문의해주세요.");break;case 409:l.setTitle("409 Conflict"),l.setMsg("요청한 서비스가 현재 사용 가능하지 않습니다. 다시 시도해 주세요.");break;default:l.setTitle("잠시 후 다시 시도해주세요"),l.setMsg("서버로부터 올바른 응답을 받지 못했습니다. 지속적으로 발생할 경우 관리자에게 문의해주세요.")}return o&&l.setTitle(o),r&&l.setMsg(r),a&&0!=a.length&&l.setErrorInfo(...a),l},loading(e={}){const{id:t="loadingModal",target:i=this.target}=e;i!==this.target&&(e.blackout=!1,e.isModal=!1);const n=f.buildLoading(e);return n.id=t,n}},y={__proto__:h,init(e={}){const{}=e},promisify:e=>g.promisifyModal(e),info:(e={})=>m.info(e).show(),confirm:(e={})=>m.confirm(e).show(),select:(e={})=>m.select(e).show(),error:(e={})=>m.error(e).show(),startLoading:(e={})=>m.loading(e).show(),endLoading(e={}){u.get("loadingModal")?.hide()},get:e=>m.persistentModal(e),getPopupList:()=>u.getAll(),show:e=>m.persistentModal(e).show(),close(e){const t=u.get(e);t?.close()},closeAll(){u.getAll().forEach((e=>{e.close()}))}};m.init();const v=["success-only","http-errors-only","no-exceptions"];class b{constructor(e={}){const{request:t,param:i,loading:n=!0,debug:s=!0,exception:o=v[1],exceptionModal:r=!0}=e;this.request=t,this.param=i,this.loading=n,this.debug=s,this.exception=o}success(e){return this.successExe=e,this}error(e){return this.errorExe=e,this}finally(e){return this.finallyExe=e,this}async exe(){try{this.loading&&y.startLoading();const e=await this.request(this.param);if(this.loading&&y.endLoading(),this.exception==v[0]&&200!=e.status)throw e;return this.successExe?.(e),e}catch(e){return this.loading&&y.endLoading(),this.debug&&console.log(e),this.exceptionModal&&y.error({response:e}),this.errorExe?.(e),null}finally{this.finallyExe?.()}}}const w=(e={})=>new b(e),C=e=>e.reduce(((e,t)=>e+(t.size?t.size:t.fileSize)),0),k={__proto__:h,update(e={}){const{multiple:t=!0}=e;this.$fileInput.multiple=t},fileInput(){const e=new MouseEvent("click",{bubbles:!1,cancelable:!1});this.$fileInput.dispatchEvent(e)},getFileSize(e){return C(e||this.addedList)},addedList:[],sizeLimit:314572800,uploadLimit:10};k.$fileInput=((e={})=>{const{multiple:t=!0,accept:i=[".pdf",".hwp",".hwpx",".pptx",".ppt",".doc",".docx",".xls",".xlsx",".jpg",".jpeg",".gif",".png",".bmp"]}=e,n=a("input");return n.setAttribute("type","file"),n.setAttribute("accept",i.toString()),n.multiple=t,n.style.display="none",n})({multiple:!0}),k.$fileInput.onchange=e=>{const t=(e=>{let t=Object.values(e.files);return t=t.filter((t=>{const i=t.name;let n=i.lastIndexOf("."),s=i.slice(n+1);return e.accept.includes("."+s)})),t.forEach((e=>{e.isNew=!0,e.fileKey=((e=16)=>((e<1||e>16)&&(e=16),([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))).substring(0,e)))(5),e.originalName=e.name})),e.value="",t})(k.$fileInput);o(t)||k.trigger("added",{files:t,size:C(t),count:t.length})},d("body").appendChild(k.$fileInput);const E=k,T=["fas","fa-cog","fa-spin"],S=["fas","fa-exclamation-triangle","colorRed"],x={MATERIAL:{cls:"kOrigin",state:[[!1,!1,!1],[!1,!0,!1],[!1,!0,!1],[!1,!0,!1],[!1,!0,!0]],icon:[[],S,T,T,[]]},COPY:{cls:"kMydocu",state:[[!0,!1,!1],[!0,!1,!1],[!1,!1,!1],[!1,!1,!1],[!0,!0,!0]],icon:[[],S,T,T,[]]},REPORT:{cls:"kReport",state:[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1],[!1,!1,!1],[!1,!0,!0]],icon:[[],S,T,T,[]]},MEMO:{cls:"kMemo",state:[[!0,!1,!1],[!0,!1,!1],[!1,!1,!1],[!1,!1,!1],[!0,!0,!0]],icon:[[],S,T,T,[]]},PHOTO:{cls:"kPicture",state:[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1],[!1,!1,!1],[!1,!0,!0]],icon:[[],S,T,T,[]]},VOICE:{cls:"kRecord",state:[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1],[!1,!1,!1],[!1,!0,!0]],icon:[[],S,T,T,[]]}},L=document.querySelector("meta[name='_csrf']")?.content,D=document.querySelector("meta[name='_csrf_header']")?.content,N=e=>Object.fromEntries(Object.entries(e).filter((([e,t])=>null!=t))),M=(e,t="GET",i=null,n={},s={})=>{const o=((e,t)=>{const i=new URLSearchParams(N(t)).toString();return i?`${e}?${i}`:e})(e,n),r={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};L&&D&&!["GET","HEAD","OPTIONS","TRACE"].includes(t.toUpperCase())&&(r[D]=L);const a={method:t,headers:{...r,...s}};return i&&("multipart/form-data"===a.headers["Content-Type"]?(delete a.headers["Content-Type"],a.body=i instanceof FormData?i:new FormData):a.headers["Content-Type"].includes("application/x-www-form-urlencoded")?a.body=i instanceof FormData?i:new URLSearchParams(i).toString():a.body=i&&JSON.stringify(i)),console.log("Request","requestUrl:",o,"data:",i,"Options:",a),fetch(o,a).then((e=>{if(!e.ok)throw e;if("0"===e.headers.get("Content-Length"))return null;const t=e.headers.get("Content-Type");if(!t||!t.includes("application/json"))return e.text();try{return e.json()}catch(e){return null}})).catch((e=>{throw console.error("Fetch error:",e),e}))},P=(e,t={})=>M(e,"GET",null,N(t),{}),O=(e,{data:t=null,queryParams:i={},headers:n={}}={})=>M(e,"POST",t,N(i),n),_=(e,{data:t=null,queryParams:i={},headers:n={}}={})=>M(e,"PUT",t,N(i),n),B=(e,{data:t=null,queryParams:i={},headers:n={}}={})=>M(e,"DELETE",t,N(i),n),K=e=>{window.location="/api/file/"+e+"/download"},I=e=>{window.location="/meeting/file/"+e+"/download"},A={Get:{meetingFileOne:e=>P(`/api/ewp/meeting/file/${e}`),meetingMaterialFileList:e=>P(`/api/ewp/meeting/${e}/file/material/list`),meetingSharedFileList:e=>P(`/api/ewp/meeting/${e}/file/shared/list`),meetingPrivateFileList:e=>P(`/api/ewp/meeting/${e}/file/private/list`),meetingAllFileList:e=>P(`/api/ewp/meeting/${e}/file/all/list`),viewMeetingFileOne:(e={})=>{const{mime:t,link:i}=e;"IMG"==t||"AUDIO"==t?window.open("/meeting/file/"+i+"/view"):window.open("/viewer?file=/meeting/file/"+i+"/view")},downloadOne:K,downloadList:e=>{for(let t=0;t<e.length;t++){let i=e[t];setTimeout((function(){K(i)}),500*t)}},downloadMeetingFileOne:I,downloadMeetingFileList:e=>{for(let t=0;t<e.length;t++){let i=e[t];setTimeout((function(){I(i)}),500*t)}},viewFileOne:(e={})=>{const{fileCategory:t,fileId:i}=e;"IMG"==t?window.open("/api/file/"+i+"/view"):window.open("/viewer?file=/api/file/"+i+"/view")}},Post:{fileList:(e={})=>{const{fileList:t}=e;return O("/api/file/list",{data:t,headers:{"Content-Type":"multipart/form-data"}})},meetingFileList:(e={})=>{const{meetingKey:t,fileType:i,fileList:n}=e;return O(`/api/ewp/meeting/${t}/file/${i}/list`,{data:n,headers:{"Content-Type":"multipart/form-data"}})}},Put:{},Delete:{meetingFileList:(e={})=>{const{meetingKey:t,fileList:i}=e;return B(`/api/ewp/meeting/${t}/file/list`,{data:i})}}},F={__proto__:h,init(e={}){const{editable:t=!0,deletable:i=!0,addConfirm:n=!1,delConfirm:s=!1,autoDisplay:o=!0,sizeLimit:r=314572800,uploadLimit:a=10}=e;return this.editable=t,this.addConfirm=n,this.delConfirm=s,this.deletable=i,this.sizeLimit=r,this.uploadLimit=a,this.oldList=[],this.newList=[],this.setBtnEvt(),console.log("init",this.editable),E.on("added",(async e=>{const{files:t,size:i,count:n}=e;if(this.addConfirm){const e=t.map((e=>e.name));if("OK"!=await y.confirm({title:"파일 업로드",msg:"선택한 파일을 업로드하시겠습니까?",detail:e}))return}const s=E.getFileSize(this.newList),o=n+this.newList.length;i+s>this.sizeLimit?y.info({msg:"업로드 허용 용량을 초과했습니다"}):o>this.uploadLimit?y.info({msg:"업로드 허용 개수를 초과했습니다"}):(this.newList.push(...t),this.setFileBox(t),this.setLimitInfo(),this.trigger("added",{files:t}))})),this},update(e={}){const{editable:t=this.editable,deletable:i=this.deletable,delConfirm:n=this.delConfirm,sizeLimit:s=this.sizeLimit,uploadLimit:o=this.uploadLimit}=e;return this.editable=t,this.delConfirm=n,this.deletable=i,this.sizeLimit=s,this.uploadLimit=o,this},setBtnEvt(){const e=d("#allChk");e&&(e=>{this.switchAllChk=()=>{0==this.getCheckedFileList().length&&(e.checked=!1)},e.onchange=()=>{1==e.checked?this.checkAll():this.uncheckAll(),this.validDownBtn?.(),this.validDelBtn?.()}})(e);const t=d("#fileDownBtn");t&&(t.disabled=!0,(e=>{this.validDownBtn=()=>{const t=this.isSelectedDowloadable();e.disabled=!t},e.onclick=()=>{const e=this.getCheckedFileList();A.Get.downloadMeetingFileList(e.map((e=>e.fileKey)))}})(t));const i=d("#fileDelBtn");i&&(i.disabled=!0,(e=>{this.validDelBtn=()=>{const t=this.isSelectedDeletable();e.disabled=!t},e.onclick=()=>{const e=this.getCheckedFileList();console.log("delete",e)}})(i));const n=d("#fileDeleteAll");n&&(e=>{e.onclick=()=>{this.clearFiles()}})(n);const s=d("#uploadBtn");s&&(s.onclick=()=>{E.fileInput()})},setLimitInfo(){if(0==this.editable)return;const e=E.getFileSize(this.newList),t=this.newList.length,i=d("#fileSize"),n=d("#fileCount");i&&(i.innerHTML=(e=>{if(0==e)return 0;const t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["Byte","KB","MB","GB","TB","PB"][t]})(e)),n&&(n.innerHTML=t+" 개")},setFiles(e){e&&(this.oldList=[...e],this.newList=[...e],this.clearFileBox(),this.setFileBox(e),this.setLimitInfo())},setFileBox(e){const t=x,i=e=>{const i=a("li");if(e.isNew){const e=a("span","badge","bg-info","mr-1");e.innerHTML="NEW",i.appendChild(e)}else if(e.roleType){const n=a("span","my-auto","mr-2"),s=a("i",...t[e.roleType].icon[e.state+2]);n.appendChild(s),i.appendChild(n)}const n=a("a");if(n.innerHTML=e.originalName?e.originalName:e.uploadedFileName,i.appendChild(n),1==this.deletable){const t=a("span","btn-del","ml-1");t.setAttribute("title","삭제"),n.appendChild(t),t.onclick=async()=>{if(this.delConfirm&&"DELETE"!=await y.confirm({title:"파일 삭제",msg:"해당 파일을 삭제합니다.",detail:["삭제된 파일에 대한 참석자들의 판서 내용도 함께 삭제됩니다."],delMode:!0}))return;i.remove();const t=e.fileKey?e.fileKey:e.fileId;this.deleteFiles(t),this.trigger("deleted",{files:[t]})}}return i},n=e=>{const i=a("tr"),[n,s,o]=t[e.roleType].state[e.state+2];i.deletable=n,i.downloadable=s,i.viewable=o;const r=a("td","text-align-center");i.appendChild(r);const c=a("input");c.type="checkbox",r.appendChild(c);const d=a("td","text-align-center",t[e.roleType].cls);i.appendChild(d);const h=a("div");d.appendChild(h);const u=a("div","tip");h.appendChild(u);const p=a("td","text-align-left");i.appendChild(p);const g=a("div","d-flex","flex-row");p.appendChild(g);const f=a("span","my-auto","mr-2"),m=a("i",...t[e.roleType].icon[e.state+2]);f.appendChild(m),g.appendChild(f);const y=a("span");return y.innerHTML=e.originalName,g.appendChild(y),1==i.viewable?(l(p,"cursor-pointer"),p.onclick=()=>{A.Get.viewMeetingFileOne({mime:e.mimeType,link:e.fileKey})}):l(p,"text-muted"),i.getFile=()=>e,i.isChecked=()=>c.checked,i.check=()=>{c.checked=!0},i.uncheck=()=>{c.checked=!1},c.onchange=()=>{this.switchAllChk?.(),this.validDownBtn?.(),this.validDelBtn?.()},i},s=d("#fileContainer");e.forEach((e=>{const t=this.editable?i(e):n(e);s.appendChild(t)}))},clearFileBox(){d("#fileContainer").innerHTML=""},checkAll(){const e=d("#fileContainer").children;Array.from(e).forEach((e=>{e.check()}))},uncheckAll(){const e=d("#fileContainer").children;Array.from(e).forEach((e=>{e.uncheck()}))},getCheckedFileList(){const e=d("#fileContainer").children;return Array.from(e).filter((e=>e.isChecked())).map((e=>e.getFile()))},isSelectedDowloadable(){const e=d("#fileContainer").children,t=Array.from(e).filter((e=>e.isChecked()));return 0!=t.length&&t.reduce(((e,t)=>e&&t.downloadable),!0)},isSelectedDeletable(){const e=d("#fileContainer").children,t=Array.from(e).filter((e=>e.isChecked()));return 0!=t.length&&t.reduce(((e,t)=>e&&t.deletable),!0)},deleteFiles(...e){this.newList=this.newList.filter((t=>!e.includes(t.fileKey))),this.setLimitInfo()},clearFiles(){this.newList=[],this.setLimitInfo(),this.clearFileBox()},getAddedFiles(){const e=this.oldList.map((e=>e.fileKey));return this.newList.filter((t=>!e.includes(t.fileKey)))},getDeletedFiles(){const e=this.newList.map((e=>e.fileKey));return this.oldList.filter((t=>!e.includes(t.fileKey))).map((e=>e.fileKey))}},H={__proto__:h,async init(e={}){const{instanceProvider:t,deletable:i=!1}=e;F.init({addConfirm:!0,delConfirm:!0}),F.on("added",(async e=>{const{files:i}=e;y.startLoading({text:"파일을 업로드 중입니다...",animation:"foldingCube"});const n=new FormData;for(const e of i)n.append("list",e);await w({request:A.Post.meetingFileList,param:{meetingKey:t.meetingKey,fileType:"MATERIAL",fileList:n},loading:!1,exception:"success-only"}).success((e=>{const t=e.error,i=t?.map((e=>"업로드 실패: "+e.data.originalName));y.info({msg:"회의 첨부파일을 업로드했습니다.",detail:i}),this.trigger("change")})).error((e=>{y.error({response:e})})).finally((()=>{y.endLoading()})).exe()})),F.on("deleted",(async e=>{const{files:i}=e;await w({request:A.Delete.meetingFileList,param:{meetingKey:t.meetingKey,fileList:i},exception:"success-only"}).success((e=>{const t=e.error,i=t?.map((e=>"삭제 실패: "+e.data.originalName));y.info({msg:"회의 첨부파일을 삭제했습니다.",detail:i}),this.trigger("change")})).error((e=>{y.error({response:e})})).finally((()=>{y.endLoading()})).exe()})),this.instanceProvider=t;const n=this.instanceProvider.meetingKey,s=await A.Get.meetingMaterialFileList(n);this.setFileList(s)},setFileList(e){this.fileMap?this.fileMap.clear():this.fileMap=new Map,e.forEach((e=>this.fileMap.set(e.fileKey,e))),this.showFileList()},getFileList(){return Array.from(this.fileMap.values())},getFile(e){return this.fileMap.get(e)},updateFile(e){this.fileMap.set(e.fileKey,e),this.showFileList(),F.setFiles(this.getFileList())},showFileList(){const e=this.getFileList(),t=x,i=e=>{const i=a("li","align-center"),n=a("span");n.innerHTML=e.originalName;const[s,o,r]=t[e.roleType].state[e.state+2];if(1==r)l(n,"cursor-pointer","href-link"),n.onclick=()=>{this.trigger("select",{file:e,pageno:1})};else{const s=a("span","my-auto","mr-2"),o=a("i",...t[e.roleType].icon[e.state+2]);s.appendChild(o),i.appendChild(s),l(n,"text-muted")}return i.appendChild(n),i},n=d("#fileListBox");n.innerHTML="";for(const t of e){if(-1==t.state)continue;t.state;const e=i(t);n.appendChild(e)}},async showFileMng(){const e=this.instanceProvider.attendRole;F.update({deletable:"HOST"==e||"ASSISTANT"==e}),F.setFiles(this.getFileList()),await y.show("fileModal")},enableSelect(){c(".docuLeftSection","disabled"),c(".fileSection","disabled"),c(".docuPagingDiv","disabled")},disableSelect(){l(".docuLeftSection","disabled"),l(".fileSection","disabled"),l(".docuPagingDiv","disabled")},enableUpload(){const e=d("#fileMngBtn");e.style.display="inline-flex",this.off("change"),this.on("change",(async()=>{this.instanceProvider.getSocketService().sendSyncMsg({resourceType:"FILE"})})),e.onclick=async()=>{e.disabled=!0,this.showFileMng(),e.disabled=!1}},disableUpload(){const e=d("#fileMngBtn");e.onclick=null,e.style.display="none",this.off("change")}},R={__proto__:h,init(e={}){const{endPoint:t="/ws",broker:i="/subscribe",destinationPrefixes:n="/topic",debug:s=!1}=e;this.endPoint=t,this.broker=i,this.destinationPrefixes=n,this.debug=s,this.connected=!1},connect(){this.disconnect(),this.socket=new SockJS(this.endPoint),this.stompClient=Stomp.over(this.socket),0==this.debug&&(this.stompClient.debug=()=>{}),this.stompClient.connect({},(()=>{this.connected=!0,this.trigger("connected")}),(e=>{this.connected=!1,this.trigger("disconnected")}))},disconnect(){this.stompClient?.disconnect()},subscribe(e={}){const{url:t=null,receiver:i=null}=e;return this.stompClient.subscribe(this.broker+t,(e=>{this.trigger("receive",e)})),this},send(e={}){const{url:t=this.destinationUrl,msg:i=null}=e;this.destinationUrl=t,this.stompClient.send(this.destinationPrefixes+this.destinationUrl,{},JSON.stringify(i))}},U={__proto__:h,init(e={}){const{instanceProvider:t,destinationURL:i,debug:n=!1}=e;this.debug=n,this.instanceProvider=t,this.destinationURL=i},update(e={}){const{serviceProvider:t=this.serviceProvider,destinationURL:i=this.destinationURL}=e;this.serviceProvider=t,this.destinationURL=i},connect(e){return R.init({debug:this.debug}),R.connect(),R.on("connected",(()=>{this.connectedExe?.()})),R.on("disconnected",(()=>{this.disconnectedExe?.()})),this},disconnect(){R.off("connected"),R.off("disconnected"),R.disconnect(),this.disconnectedExe?.()},isConnected:()=>R.connected,connected(e){return this.connectedExe=e,this},disconnected(e){return this.disconnectedExe=e,this},async subscribe(e={}){const{url:t,receiver:i}=e;R.subscribe({url:t,receiver:i}),R.on("receive",i)},sendJoinMsg(){R.send({url:"/join/"+this.instanceProvider.meetingKey})},sendUpdateMsg(e={}){const{url:t=this.destinationURL,resourceType:i,data:n}=e;R.send({url:t,msg:{messageType:"UPDATE",resourceType:i,data:n}})},sendSyncMsg(e={}){const{url:t=this.destinationURL,resourceType:i}=e;R.send({url:t,msg:{messageType:"SYNC",resourceType:i}})},sendNoticeMsg(e={}){const{url:t=this.destinationURL,actionType:i,data:n}=e;R.send({url:t,msg:{messageType:"NOTICE",actionType:i,data:n}})}},z={infoCon:"<li></li>",infoBody:{infoBtn:'<div class="infoLinkBtn"></div>',name:'<div class="userName ellipsis"></div>',sign:'<div class="attendSign"></div>',attendBtn:'<div class="switchBtn switchOff" title="참석/불참"></div>'},assistantBody:{nameInput:'<input type="text" class="assistantBtn" placeholder="클릭하여 진행자를 지정하세요" readonly>',assignBtn:'<div class="btn-add assistantBtn margin-left-4 margin-right-auto" title="보조 진행자 지정"></div>'}},Y={imgCon:"<li></li>",img:"<img>",menu:{con:'<div class="thumbMenu"></div>',icon:'<i class="fas fa-ellipsis-v"></i>'}},q={overlay:'<div class="overlay"></div>',base:'<div class="menuToolDiv thumbMenuDiv"></div>',con:'<div class="subDiv"></div>',item:'<button type="button" class="item"></button>'},j=(e,t)=>t.some((t=>e instanceof t));let G,X;const W=new WeakMap,V=new WeakMap,J=new WeakMap,Q=new WeakMap,Z=new WeakMap;let ee={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return V.get(e);if("objectStoreNames"===t)return e.objectStoreNames||J.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return ne(e[t])},set:(e,t,i)=>(e[t]=i,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function te(e){ee=e(ee)}function ie(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(X||(X=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(se(this),e),ne(W.get(this))}:function(...e){return ne(t.apply(se(this),e))}:function(e,...i){const n=t.call(se(this),e,...i);return J.set(n,e.sort?e.sort():[e]),ne(n)}:(e instanceof IDBTransaction&&function(e){if(V.has(e))return;const t=new Promise(((t,i)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{t(),n()},o=()=>{i(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)}));V.set(e,t)}(e),j(e,G||(G=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ee):e);var t}function ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,i)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{t(ne(e.result)),n()},o=()=>{i(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&W.set(t,e)})).catch((()=>{})),Z.set(t,e),t}(e);if(Q.has(e))return Q.get(e);const t=ie(e);return t!==e&&(Q.set(e,t),Z.set(t,e)),t}const se=e=>Z.get(e);function oe(e,t,{blocked:i,upgrade:n,blocking:s,terminated:o}={}){const r=indexedDB.open(e,t),a=ne(r);return n&&r.addEventListener("upgradeneeded",(e=>{n(ne(r.result),e.oldVersion,e.newVersion,ne(r.transaction))})),i&&r.addEventListener("blocked",(()=>i())),a.then((e=>{o&&e.addEventListener("close",(()=>o())),s&&e.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}function re(e,{blocked:t}={}){const i=indexedDB.deleteDatabase(e);return t&&i.addEventListener("blocked",(()=>t())),ne(i).then((()=>{}))}const ae=["get","getKey","getAll","getAllKeys","count"],le=["put","add","delete","clear"],ce=new Map;function de(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ce.get(t))return ce.get(t);const i=t.replace(/FromIndex$/,""),n=t!==i,s=le.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!ae.includes(i))return;const o=async function(e,...t){const o=this.transaction(e,s?"readwrite":"readonly");let r=o.store;return n&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),s&&o.done]))[0]};return ce.set(t,o),o}te((e=>({...e,get:(t,i,n)=>de(t,i)||e.get(t,i,n),has:(t,i)=>!!de(t,i)||e.has(t,i)})));const he=["continue","continuePrimaryKey","advance"],ue={},pe=new WeakMap,ge=new WeakMap,fe={get(e,t){if(!he.includes(t))return e[t];let i=ue[t];return i||(i=ue[t]=function(...e){pe.set(this,ge.get(this)[t](...e))}),i}};async function*me(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const i=new Proxy(t,fe);for(ge.set(i,t),Z.set(i,se(t));t;)yield i,t=await(pe.get(i)||t.continue()),pe.delete(i)}function ye(e,t){return t===Symbol.asyncIterator&&j(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&j(e,[IDBIndex,IDBObjectStore])}te((e=>({...e,get:(t,i,n)=>ye(t,i)?me:e.get(t,i,n),has:(t,i)=>ye(t,i)||e.has(t,i)})));class ve{mutex=new s;constructor(e={}){const{DB_NAME:t="INDEXED_DB",DB_VERSION:i,STORE_NAME:n="MEMO",INDEX_LIST:s=["id","page"]}=e;this.DB_NAME=t,this.INDEX_LIST=s,this.setDB(this.DB_NAME,i,n)}setDB(e,t,i){return new Promise((async(n,s)=>{this.DB&&this.DB.close(),await this.clearExpiredDB(),this.STORE_NAME=i;const o=this.INDEX_LIST;this.DB=await oe(e,t,{upgrade(e){e.objectStoreNames.contains("CONFIG")||e.createObjectStore("CONFIG",{autoIncrement:!0}).createIndex("key","key"),e.objectStoreNames.contains("BOOKMARK")||e.createObjectStore("BOOKMARK",{autoIncrement:!0}).createIndex("key","key"),i&&(t=>{const i=e.createObjectStore(t,{autoIncrement:!0});if(o)for(const e of o)i.createIndex(e,e)})(i)}}),this.DB_VERSION=this.DB.version,await this.setExpire(),n()}))}unsetDB(e){return new Promise((async(t,i)=>{this.DB&&this.DB.close(),await re(e),t()}))}setExpire(){return new Promise((async(e,t)=>{if(0==(await this.DB.getAllFromIndex("CONFIG","key","EXP")).length){const e=new Date,t=new Date(e.setDate(e.getDate()+1));this.DB.add("CONFIG",{key:"EXP",value:t.getTime()})}e()}))}clearExpiredDB(){return new Promise((async(e,t)=>{const i=await indexedDB.databases();for(const e of i){const t=Date.now(),i=await oe(e.name);try{const n=(await i.getAllFromIndex("CONFIG","key","EXP"))[0].value;i.close(),t>n&&await re(e.name)}catch(t){i.close(),await re(e.name)}}e()}))}async setBookmark(e,t){await this.DB.put("BOOKMARK",t,e)}async getBookmark(e){return await this.DB.get("BOOKMARK",e)||[]}setStore(e){return new Promise((async(t,i)=>{this.mutex.runExclusive((async()=>{try{const i=this.DB.objectStoreNames;let n=this.DB_VERSION+1;for(const t in i)if(i[t]==e){n=this.DB_VERSION;break}await this.setDB(this.DB_NAME,n,e),t()}catch(t){return await this.unsetDB(this.DB_NAME),await this.setDB(this.DB_NAME,void 0,e),this.setStore(e)}}))}))}insert(e,t){return new Promise((async(i,n)=>{this.mutex.runExclusive((async()=>{this.STORE_NAME==e&&await this.DB.add(this.STORE_NAME,t),i()}))}))}shiftLeftIndex(e,t,i){return new Promise((async(n,s)=>{this.mutex.runExclusive((async()=>{if(this.STORE_NAME==e){const e=this.DB.transaction(this.STORE_NAME,"readwrite").store.index(t);for await(const n of e.iterate()){const e={...n.value},s=e[t];s>i&&(e[t]=s-1,n.update(e))}}n()}))}))}shiftRightIndex(e,t,i){return new Promise((async(n,s)=>{this.mutex.runExclusive((async()=>{if(this.STORE_NAME==e){const e=this.DB.transaction(this.STORE_NAME,"readwrite");for await(const n of e.store){const e={...n.value},s=e[t];s>=i&&(e[t]=s+1,n.update(e))}}n()}))}))}deleteLast(e){return new Promise((async(t,i)=>{this.mutex.runExclusive((async()=>{if(this.STORE_NAME==e){let e,t=await this.DB.transaction(this.STORE_NAME).store.openCursor();for(;t;){const i=await t.continue();i||(e=t.key),t=i}e&&await this.DB.delete(this.STORE_NAME,e)}t()}))}))}deleteDataFromIndex(e,t,i){return new Promise((async(n,s)=>{this.mutex.runExclusive((async()=>{if(this.STORE_NAME==e){const e=await this.DB.getAllKeysFromIndex(this.STORE_NAME,t,i);for(const t of e)await this.DB.delete(this.STORE_NAME,t)}n()}))}))}clearStore(e){return new Promise((async(t,i)=>{this.mutex.runExclusive((async()=>{this.STORE_NAME==e?(await this.DB.clear(this.STORE_NAME),t()):t()}))}))}getAllData(e){return new Promise((async(t,i)=>{this.mutex.runExclusive((async()=>{if(this.STORE_NAME==e){const e=await this.DB.getAll(this.STORE_NAME);t(e)}else t()}))}))}getAllDataWithKeys(){return new Promise((async(e,t)=>{const i=await this.DB.getAllKeys(this.STORE_NAME),n=[];for(const e of i){const t=await this.DB.get(this.STORE_NAME,e);t.key=e,n.push(t)}e(n)}))}getDataFromIndex(e,t,i){return new Promise((async(n,s)=>{this.mutex.runExclusive((async()=>{if(this.STORE_NAME==e){const e=await this.DB.getAllFromIndex(this.STORE_NAME,t,i);n(e)}else n()}))}))}}const be={on(e,t){this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push(t)},off(e,t){let i=this._eventHandlers?.[e];if(i)for(let e=0;e<i.length;e++)i[e]===t&&i.splice(e--,1)},trigger(e,...t){this._eventHandlers?.[e]&&this._eventHandlers[e].forEach((e=>e.apply(this,t)))}};class we{constructor(e={}){const{instance:t=null,width:i=300,height:n=150,image:s=null,color:o="white",scale:r=1}=e;this.instance=t,this.nowWidth=i,this.nowHeight=n,this.scale=r,this.resizeScreen({width:i,height:n}),this.deployScreenSizeObserver(),this.setBackgroundColor(o),this.transformScale()}deployScreenSizeObserver(){new ResizeObserver(((e,t)=>{this.fitOrientation?this.fitOrientation():this.transformScale()})).observe(this.instance.sectionNode)}resizeScreen(e={}){const{width:t=300,height:i=150}=e;this.width=t,this.height=i;const n=this.instance.svgNode;n.setAttribute("width",t),n.setAttribute("height",i);const s=this.instance.screenNode;s.style.width=t+"px",s.style.height=i+"px"}fitScreenToWindow(){this.width>this.height?this.fitHorizontalOrientation():this.fitVerticalOrientation()}fitVerticalOrientation(){this.fitOrientation=this.fitVerticalOrientation;const e=(this.instance.sectionNode.offsetHeight-6)/this.height;this.transformScale({scale:e})}fitHorizontalOrientation(){this.fitOrientation=this.fitHorizontalOrientation;const e=(this.instance.sectionNode.offsetWidth-6)/this.width;this.transformScale({scale:e})}zoomin(e){e||(e=.05);const t=this.scale;this.changeScale(t+e)}zoomout(e){e||(e=.05);const t=this.scale;this.changeScale(t-e)}changeScale(e){delete this.fitOrientation;let t=Number(e)?e:this.scale;t>4?t=4:t<.3&&(t=.3),this.transformScale({scale:t})}transformScale(e={}){const{scale:t=this.scale}=e;this.scale!=t&&this.trigger("transformScale",t),this.scale=t;const i=this.instance,n=i.sectionNode,s=i.screenNode,o=i.containerNode;s.style.width=this.width*t+"px",s.style.height=this.height*t+"px";const r=n.offsetHeight-s.offsetHeight;s.style.marginTop=r>0?r/2+"px":0,o.style.transform="scale("+t+")",o.setAttribute("scale",t)}setBackgroundImage(e){const t=this,i=t.instance.svgNode;return new Promise((function(n,s){const o=new Image;o.onload=function(){i.style.background="url("+o.src+")",i.style.backgroundRepeat="no-repeat",i.style.backgroundSize="cover",i.setAttribute("width",o.width),i.setAttribute("height",o.height),t.width=o.width,t.height=o.height,t.image=o,t.transformScale(),n()},o.onerror=function(e){s(e)},o.src=e}))}getBackgroundImage(){return this.image}setBackgroundColor(e={}){const{color:t="#ffffff",opacity:i=1}=e;this.instance.svgNode.style.backgroundColor=t,this.instance.svgNode.style.background="none"}switchCtrlmode(e){const t=this.instance.svgNode;0!=this.instance.options.selectable&&(e?(t.classList.add("ctrl-mode"),t.setAttribute("pointer-events","visiblePainted")):(t.classList.remove("ctrl-mode"),t.setAttribute("pointer-events","none")))}switchErasermode(e){const t=this.instance.svgNode,i=t.getDeployNode(2);t.classList.remove("ctrl-mode"),e?(t.setAttribute("pointer-events","visiblePainted"),t.querySelectorAll("polyline").forEach((e=>e.setAttribute("pointer-events","visiblePainted"))),i.style.pointerEvents="none"):(i.style.pointerEvents="",t.setAttribute("pointer-events","none"),t.querySelectorAll("polyline").forEach((e=>e.setAttribute("pointer-events","none"))))}}Object.assign(we.prototype,be);class Ce{constructor(e={}){const{type:t,posX:i=0,posY:n=0,width:s=0,height:o=0,stroke:r="#000000",strokeOpacity:a=1,strokeWidth:l=2,strokeDasharray:c=null,strokeLinejoin:d="round",strokeLinecap:h="round",fill:u="none",fillOpacity:p=0,level:g=1}=e;this.type=t,this.posX=i,this.posY=n,this.width=s,this.height=o,this.stroke=r,this.strokeOpacity=a,this.strokeWidth=l,this.strokeDasharray=c,this.strokeLinejoin=d,this.strokeLinecap=h,this.fill=u,this.fillOpacity=p,this.level=g}update(e={}){const{type:t=this.type,posX:i=this.posX,posY:n=this.posY,width:s=this.width,height:o=this.height,stroke:r=this.stroke,strokeOpacity:a=this.strokeOpacity,strokeWidth:l=this.strokeWidth,strokeDasharray:c=this.strokeDasharray,fill:d=this.fill,fillOpacity:h=this.fillOpacity,level:u=this.level}=e;this.type=t,this.posX=i,this.posY=n,this.width=s,this.height=o,this.stroke=r,this.strokeOpacity=a,this.strokeWidth=l,this.strokeDasharray=c,this.level=u,this.trigger("update")}getDependencyAttribute(){return{type:this.type}}getStyleAttribute(){return{stroke:this.stroke,"stroke-opacity":this.strokeOpacity,"stroke-width":this.strokeWidth,"stroke-dasharray":this.strokeDasharray,"stroke-linejoin":this.strokeLinejoin,"stroke-linecap":this.strokeLinecap,fill:this.fill,"fill-opacity":this.fillOpacity}}getCoordinateAttribute(){return{posX:this.posX,posY:this.posY,width:this.width,height:this.height}}getProperties(){return{type:this.type,...this.getCoordinateAttribute(),stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeWidth:this.strokeWidth,strokeDasharray:this.strokeDasharray,strokeLinejoin:this.strokeLinejoin,strokeLinecap:this.strokeLinecap,fill:this.fill,fillOpacity:this.fillOpacity}}setStroke(e){this.stroke=e}setStrokeWidth(e){this.strokeWidth=e}setStrokeOpacity(e){this.strokeOpacity=e}setStrokeDasharray(e){this.strokeDasharray=e}setFill(e){this.fill=e}setFillOpacity(e){this.fillOpacity=e}getLevel(){return this.level}}class ke extends Ce{constructor(e={}){super(e);const{startPos:t=[0,0],endPos:i=[0,0]}=e;this.startPos=t,this.endPos=i}update(e={}){super.update(e);const{startPos:t=this.startPos,endPos:i=this.endPos}=e;this.startPos=t,this.endPos=i}getStyleAttribute(){return{stroke:this.stroke,"stroke-opacity":this.strokeOpacity,"stroke-width":this.strokeWidth,"stroke-dasharray":this.strokeDasharray,fill:this.fill,"fill-opacity":this.fillOpacity}}getCoordinateAttribute(){return{...super.getCoordinateAttribute(),startPos:this.startPos,endPos:this.endPos,pointGroup:[this.startPos,this.endPos]}}}class Ee extends ke{constructor(e={}){super({...e,type:"textarea"});const{text:t="",color:i="#000000",fontSize:n=28,fontFamily:s="sans-serif"}=e;this.text=t,this.color=i,this.fontSize=n,this.fontFamily=s}update(e={}){super.update(e);const{text:t=this.text,color:i=this.color,fontSize:n=this.fontSize,fontFamily:s=this.fontFamily}=e;this.text=t,this.color=i,this.fontSize=n,this.fontFamily=s}getFontAttribute(){return{color:this.color,"font-size":this.fontSize,"font-family":this.fontFamily}}getText(){return this.text}setText(e){this.text=e}setFontColor(e){this.color=e}setFontSize(e){this.fontSize=e}setFontFamily(e){this.fontFamily=e}toObject(){return{...super.getProperties(),text:this.text,color:this.color,fontSize:this.fontSize,fontFamily:this.fontFamily}}static builder(e={}){return new Path(e)}}Object.assign(Ee.prototype,be);class Te{constructor(e={}){const{id:t=null,shape:i=null,packedElem:n=null,selected:s=!1,visible:o=!0,level:r=1}=e;this.id=t,this.shape=i,this.packedElem=n,this.selected=s,this.visible=o,this.level=r}select(){this.selected=!0}deselect(){this.selected=!1}isSelected(){return this.selected}show(){this.packedElem.removeAttribute("visibility"),this.visible=!0}hide(){this.packedElem.setAttribute("visibility","hidden"),this.visible=!1}isVisible(){return this.visible}setLevel(e){this.level=e}getLevel(){return this.level}destroy(){delete this.shape,this.packedElem?.remove(),delete this.packedElem}getShape(){return this.shape}getPackedElem(){return this.packedElem}getCoordElem(){return this.packedElem.coordNode}getGraphicElem(){return this.packedElem.graphicNode}getForeignElem(){return this.packedElem.foreignNode}getEditTool(){this.shape}toContext(){return{id:this.id,level:this.level,shape:this.shape.toObject()}}}const Se={createElementNS:function(e,t){return Ne(e,t)},setElementAttributes:function(e,t){Me(e,t)},createSVG:function(e,t){const i=Ne("g",{id:e,role:"container"}),n=Ne("svg",{role:"coordinator",preserveAspectRatio:"none",overflow:"visible"});i.appendChild(n),i.coordNode=n;const s=t.type;let o;switch(s){case"path":case"line":case"polyline":case"rect":o=Pe(s);break;case"textarea":{o=Pe("rect");const e=Pe(s);i.foreignNode=e,n.appendChild(e)}}return i.graphicNode=o,n.appendChild(o),this.updateSVG(t,i),i},updateSVG:function(e,t){const i=t,n=i.coordNode,s=i.graphicNode,o=i.foreignNode;Me(s,e.getStyleAttribute());const r=e.getCoordinateAttribute();switch(e.type){case"line":{const e=Le([r.startPos,r.endPos]),t=e.maxX-e.minX,i=e.maxY-e.minY;Me(n,{x:r.posX+e.minX,y:r.posY+e.minY}),Me(s,{x1:0,y1:0,x2:t,y2:i})}break;case"rect":{const e=Le([r.startPos,r.endPos]),t=e.maxX-e.minX,i=e.maxY-e.minY;Me(n,{x:r.posX+e.minX,y:r.posY+e.minY}),Me(s,{x:0,y:0,width:t,height:i})}break;case"textarea":{const t=Le([r.startPos,r.endPos]),i=t.maxX-t.minX,a=t.maxY-t.minY;Me(n,{x:r.posX+t.minX,y:r.posY+t.minY}),Me(s,{x:0,y:0,width:i,height:a});const l=e.getFontAttribute();Me(o,{x:0,y:0,width:i,height:a});const c=o.textareaElem;c.style.color=l.color,c.style.fontSize=l["font-size"]+"px",c.style.fontFamily=l["font-family"];const d=e.getText();c.value=d}break;case"path":{const e=function(e){const t=e.concat(),i=Le(xe(t));return{...i,pointGroupList:t.map((e=>e.map((e=>[e[0]-i.minX,e[1]-i.minY]))))}}(r.pointGroup),t=e.maxX-e.minX,i=e.maxY-e.minY,o=function(e){let t="";for(const i of e)t+=De(i);return t}(e.pointGroupList);Me(n,{x:r.posX+e.minX,y:r.posY+e.minY,width:r.width?r.width:t,height:r.height?r.height:i,viewBox:"0 0 "+t+" "+i}),Me(s,{x:0,y:0,d:o})}break;case"polyline":Me(s,{x:0,y:0,points:function(e){let t=e[0][0]+","+e[0][1]+" ";for(let i=1;i<e.length;i++){let n=e[i];t+=n[0]+","+n[1]+" "}return t}(r.pointGroup)})}}};function xe(e,t=1){return t>0?e.reduce(((e,i)=>e.concat(Array.isArray(i)?xe(i,t-1):i)),[]):e.slice()}function Le(e){if(0==e.length)return{minX:0,maxX:0,minY:0,maxY:0};let t=e[0][0],i=e[0][0],n=e[0][1],s=e[0][1];return e.length<2?{minX:t,maxX:t,minY:n,maxY:n}:(e.forEach((e=>{const o=e[0],r=e[1];t=t>o?o:t,i=i<o?o:i,n=n>r?r:n,s=s<r?r:s})),{minX:t,maxX:i,minY:n,maxY:s})}function De(e){let t=e[0],i="M"+t+" ";1==e.length&&e.push(e[0]);for(let o=1;o<e.length;o++){const r=e[o];i+="Q"+(n=t,s=r,[(Number(n[0])+Number(s[0]))/2,(Number(n[1])+Number(s[1]))/2]+" "),i+=r,t=r}var n,s;return i}function Ne(e,t){const i=document.createElementNS("http://www.w3.org/2000/svg",e);return Me(i,t),i}function Me(e,t){if(null!=t)for(let i in t){const n=t[i];0==n||null!=n&&null!=n&&""!=n?e.setAttribute(i,n):e.removeAttribute(i)}}function Pe(e,t){switch(e){case"line":case"path":case"polyline":case"rect":return Ne(e,t);case"textarea":{const e=Ne("foreignObject"),t=document.createElement("textarea");return t.style.cssText="width: 100%;height: 100%;background: transparent;fill: none;border: none;resize: none;overflow: hidden;",e.textareaElem=t,t.getContainer=function(){return e.getContainer()},e.appendChild(t),e}}}const $e=function(e={}){const{id:t=null,shape:i=null,level:n=1}=e,s=Se.createSVG(t,i),o=new Te({id:t,shape:i,packedElem:s,level:n});return i.on("update",(function(){setTimeout((()=>Se.updateSVG(i,s)))})),o};class Oe extends Ce{constructor(e={}){super(e);const{pointGroup:t=[[[0,0]]]}=e;this.pointGroup=t}update(e={}){super.update(e);const{pointGroup:t=this.pointGroup}=e;this.pointGroup=t}getCoordinateAttribute(){return{...super.getCoordinateAttribute(),pointGroup:this.pointGroup}}getProperties(){return{...super.getProperties(),pointGroup:this.pointGroup}}}class _e extends Oe{constructor(e={}){super({...e,type:"path"});const{}=e}update(e={}){super.update(e)}toObject(){return super.getProperties()}}Object.assign(_e.prototype,be);class Be extends Oe{constructor(e={}){super({...e,type:"polyline"});const{}=e}update(e={}){super.update(e)}toObject(){return super.getProperties()}}Object.assign(Be.prototype,be);class Ke extends ke{constructor(e={}){super({...e,type:"line"})}update(e={}){super.update(e)}toObject(){return super.getProperties()}}Object.assign(Ke.prototype,be);class Ie extends ke{constructor(e={}){super({...e,type:"rect"})}update(e={}){super.update(e)}getFontAttribute(){return{color:this.color,"font-size":this.fontSize,"font-family":this.fontFamily}}toObject(){return super.getProperties()}}Object.assign(Ie.prototype,be);class Ae{constructor(e={}){const{instance:t=null}=e;this.instance=t,this.empty()}empty(){this.instance.svgNode.clearGraphic(),this._display?.map((e=>e.destroy())),this._display=[],this._garbage?.map((e=>e.destroy())),this._garbage=[]}isEmpty(){return 0==this._display.length}createShapeModel(e,t){let i;switch(e){case"line":i=new Ke(t);break;case"rectangle":i=new Ie(t);break;case"textarea":i=new Ee(t);break;case"path":i=new _e(t);break;case"polyline":i=new Be(t)}return i}createUpdateModel(e,t={}){return{id:e,action:"U",shape:{...t}}}createDeleteModel(e){return{id:e,action:"D"}}create(e){return $e(e)}insert(e){return this.get(e.id)||(this._display.push(e),this.instance.svgNode.querySelector("#"+e.id)?.remove(),this.instance.svgNode.addGraphic({element:e.getPackedElem(),level:e.getLevel()})),e}load(e){const t={...e};switch(t.action){case"N":{t.shape=this.createShapeModel(t.shape.type,t.shape);const e=$e(t);this.insert(e)}break;case"U":{const e=this.get(t.id);e?.shape?.update(t.shape)}break;case"D":this.remove(t.id)}}remove(e){const t=this.get(e);return t&&(this._display=this._display.filter((t=>t.id!==e)),this._garbage.push(t),t.hide()),t}runGarbageCollector(){const e=this._display.filter((e=>!e.isVisible()||!e.packedElem));this._garbage=this._garbage.concat(e),this._garbage.forEach((e=>e.destroy())),this._garbage=[]}get(e){return this._display.find((t=>t.id==e))}getAll(){return this._display}select(e){this._display.forEach((e=>e.deselect()));const t=this.get(e);return t?.select(),t}getSelected(){return this._display.find((e=>e.isSelected()))}restore(e){this.empty();const t=JSON.parse(e);t.forEach((e=>{e.shape=this.createShapeModel(e.shape.type,e.shape)})),t.forEach((e=>{const t=this.create(e);this.insert(t)}))}}Object.assign(Ae.prototype,be);class Fe{constructor(e){this.empty(),this._service=e}empty(){this._undoStack=[],this._redoStack=[]}dump(){this._dump=He(this._service._display)}take(){let e=this._dump;e||(e=He(this._service._display)),this._undoStack.push(e),this._redoStack=[],this._dump=void 0}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop(),t=He(this._service._display);this._redoStack.push(t),this._service.restore(e)}}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop(),t=He(this._service._display);this._undoStack.push(t),this._service.restore(e)}}hasRedo(){return this._redoStack.length>0}}function He(e){const t=e.map((e=>e.toContext()));return JSON.stringify(t)}const Re={con:'<div id="editTool"></div>',header:{con:'<div class="editToolHeader"></div>',paleteIcon:'<i class="fas fa-palette"></i>',delIcon:'<i class="fas fa-trash-alt"></i>'},palete:{con:'<div class="editToolProperty subDiv" style="display:none">',font:{con:'<div class="fontSizeDiv"><div class="item">크기</div></div>',item:'<div class="tt"></div>'},color:{con:'<div class="colorDiv"><div class="item">색상</div></div>',item:'<div class="cc"></div>'},close:{con:'<div class="closeBtnDiv sUp"></div>',icon:'<i class="fal fa-angle-up"></i>'}}};class Ue{constructor(e={}){const{rootNode:t=null,svgNode:i=null}=e;this.rootNode=t,this.svgNode=i}startEdit(e){if(this.stopEdit(),this.graphic=e,e){const t=e.getShape();if("textarea"==t?.type){const t=e.getForeignElem();this.textareaElem=t.querySelector("textarea")}}ze.call(this),Ye.call(this),qe.call(this),je.call(this)}stopEdit(){const e=this.graphic;if(e){const t=e.getShape();if("textarea"==t?.type){const t=e.getForeignElem().querySelector("textarea");t.blur(),t.setAttribute("disabled",!0)}}this.boundaryNode?.remove(),delete this.boundaryNode,this.editTool?.remove(),delete this.editTool,this.observer?.disconnect(),delete this.observer}show(){this.editTool?.show()}hide(){this.editTool?.hide()}}function ze(){const e=this,t=e.rootNode,i=e.graphic,n=i.getShape(),s=[28,32,36,40,44],o=["#000000","#e90000","#0076e3","#00b100","#ffba00","#ffffff"];!function(){const r=Re,a=$(r.con);e.editTool=a,t.appendChild(a[0]);const l=r.header,c=$(l.con);a.append(c),n instanceof Ee&&function(){const t=r.palete,d=$(t.con),h=$(t.font.con);for(const[n,o]of s.entries()){const s=$(t.font.item);s.text(n+1),h.append(s),s.on("click",(function(){e.trigger("changeFontSize",i,o)}))}d.append(h);const u=$(t.color.con);for(const n of o){const s=$(t.color.item);s.css({border:"1px solid #999","background-color":n}),u.append(s),s.on("click",(function(){f.css("color",n),e.trigger("changeFontColor",i,n)}))}d.append(u);const p=$(t.close.con),g=$(t.close.icon);p.append(g),p.on("click",(function(){d.slideUp(100)})),d.append(p),a.append(d);const f=$(l.paleteIcon);f.css("color",n.color),f.on("click",(function(e){d.is(":visible")?d.slideUp(100):d.slideDown(100)})),c.append(f)}(),function(){const t=$(l.delIcon);c.append(t),t.on("click",(async t=>{t.stopPropagation(),t.preventDefault(),"DELETE"==await y.confirm({msg:"텍스트 입력을 삭제합니다.",delMode:!0})?e.trigger("deleteElem",i.id):e.textareaElem.focus()}))}()}(),function(){const t=["x","y","width","height","scale"],n=new MutationObserver((function(i,n){for(const n of i)if("childList"===n.type)console.log("A child node has been added or removed.");else if("attributes"===n.type){const i=n.attributeName;t.includes(i)&&je.call(e,i)}}));var s={attributes:!0,childList:!0,characterData:!0};const o=i.getCoordElem();n.observe(o,s),n.observe(e.rootNode,s),e.observer=n}()}function Ye(){const e=this,t=e.graphic,i=(t.getPackedElem(),t.getGraphicElem(),t.getShape(),function(e={}){const{x:t=0,y:i=0,width:n=0,height:s=0,scale:o=1}=e,r=Se.createElementNS("svg",{x:t,y:i,width:n,height:s,role:"boundary"}),a=Se.createElementNS("rect",{x:0,y:0,width:"100%",height:"100%","pointer-events":"visiblePainted",role:"boundary-box",class:"bBox",cursor:"move"});r.appendChild(a);const l=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"0%",cy:"0%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"nw",cursor:"nw-resize"}),c=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"100%",cy:"0%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"ne",cursor:"ne-resize"}),d=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"0%",cy:"100%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"sw",cursor:"sw-resize"}),h=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"100%",cy:"100%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"se",cursor:"se-resize"});r.appendChild(l),r.appendChild(c),r.appendChild(d),r.appendChild(h);const u=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"50%",cy:"0%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"n",cursor:"ns-resize"}),p=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"50%",cy:"100%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"s",cursor:"ns-resize"}),g=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"100%",cy:"50%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"e",cursor:"ew-resize"}),f=Se.createElementNS("circle",{"pointer-events":"visiblePainted",cx:"0%",cy:"50%",class:"bVertex resize",role:"boundary-vertex","resize-direction":"w",cursor:"ew-resize"});return r.appendChild(u),r.appendChild(p),r.appendChild(g),r.appendChild(f),r.update=(e={})=>{const t=r.getBBox(),{x:i=t.x,y:n=t.y,width:s=t.width,height:o=t.height,scale:l=1}=e,c=4/l,d=2/l,h=8/l;Se.setElementAttributes(r,{x:i,y:n,width:s,height:o}),a.setAttribute("stroke-width",c),r.querySelectorAll("circle").forEach((e=>{Se.setElementAttributes(e,{r:h,"stroke-width":d})}))},r.update({x:t,y:i,width:n,height:s,scale:o}),r}({x:0,y:0,width:0,height:0}));e.svgNode.appendChild(i),e.boundaryNode=i}function qe(){const e=this,t=e.graphic;if("textarea"==t.shape.type){const i=t.getForeignElem().querySelector("textarea");$(i).unbind(),$(i).on("change",(function(n){i.innerHTML=i.value,e.trigger("changeText",t,i.value)})),$(i).on("focus",(function(e){i.innerHTML})),$(i).on("keyup",(function(n){n.keyCode,i.innerHTML=i.value,e.trigger("changeText",t,i.value)})),$(i).on("blur",(function(e){i.innerHTML})),i.removeAttribute("disabled"),i.focus()}}function je(e){const t=this,i=t.graphic,n=i.shape,s=t.rootNode,o=s.getBoundingClientRect(),r=i.getCoordElem(),a=r.getBoundingClientRect(),l=r.getBBox(),c=1*r.getAttribute("x"),d=1*r.getAttribute("y"),h=n.width?n.width:l.width,u=n.height?n.height:l.height,p=s.getAttribute("scale"),g=n.strokeWidth*p,f=(4+g)*p,m=(a.left,o.left,a.top,o.top,t.editTool);switch(m.css("transform","scale("+1/p+")"),e){case"x":m.css("left",c-f/2+"px");break;case"y":m.css("top",d-f/2+"px");break;case"width":case"height":break;default:m.css("left",c-f/2+"px"),m.css("top",d-f/2+"px")}t.boundaryNode.update({x:c-g/2,y:d-g/2,width:h+g,height:u+g,scale:p})}Object.assign(Ue.prototype,h);class Ge{constructor(e={}){const{type:t,name:i="",title:n="",icon:s="fas fa-tools"}=e;this.type=t,this.name=i,this.title=n,this.icon=s}setType(e){this.type=e}}Object.assign(Ge.prototype,be);class Xe extends Ge{constructor(e={}){super({...e,type:"eraser"})}}class We extends Ge{constructor(e={}){super({...e,type:"control"})}}class Ve extends Ge{constructor(e={}){super({...e,type:"zoom"});const{zoom:t=""}=e;this.zoom=t}}class Je extends Ge{constructor(e={}){super({...e,type:"fit"});const{fit:t="vertical"}=e;this.fit=t}}const Qe={getUUID:function(e){return e||(e=16),([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))).substring(0,e)},roundToTwo:function(e){return+(Math.round(e+"e+2")+"e-2")},defer:(e,t)=>function(){setTimeout((()=>e.apply(this,arguments)),t)},getPointerPos:function(e,t,i){let n=Qe.roundToTwo(e.offsetX)/t,s=Qe.roundToTwo(e.offsetY)/t;return i?{x:n,y:s}:{x:Math.floor(n),y:Math.floor(s)}},getDistance:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},Ze={createInterface(){if(this.element)return;const e=this,t=$('<div class="tool"></div>');t.attr("title",e.title);let i=$("<i></i>");return i.addClass(e.icon),t.append(i),t.on("click",(function(){e.trigger("select")})),this.element=t,t},select(){const e=this.element;e&&e.addClass("selected")},unselect(){const e=this.element;e&&e.removeClass("selected")},enable(){this.activate=!0,this.element?.removeClass("disabled")},disable(){this.activate=!1,this.element?.addClass("disabled")},show(){this.element?.removeClass("d-none")},hide(){this.element?.addClass("d-none")}},et={__proto__:Ze,enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},toContext(){return{id:"G"+Qe.getUUID(6),action:"N",shape:new this.constructor(this)}},createInterface(e,t,i){if(this.element)return;const n=this,s='<div class="item"></div>',o='<div class="sizeDiv">',r='<div class="tt"><div></div></div>',a='<div class="colorDiv">',l='<div class="cc"></div>',c=$('<div class="tool"></div>');c.attr("title",n.title);let d=$('<div class="sDown"></div>'),h=$('<div class="subDiv penSubDiv"></div>'),u=$("<i></i>");if(u.addClass(e),d.html(u),c.append(d),c.append(h),c.on("click",(function(e){$(".subDiv").not(h).slideUp(100),h.is(":visible")?h.slideUp(100):$(this).hasClass("selected")?($(this).addClass("selected"),h.slideDown(100)):$(this).addClass("selected"),n.trigger("select")})),t){let e=$(o);e.addClass("z-100");let i=$(s);i.html("두께"),e.append(i);let a=t.list,l=["t1","t2","t3","t4","t5","t6"];for(let i=0;i<a.length;i++){let s=$(r);i==t.def&&(s.addClass("selected"),n.setStrokeWidth(a[i])),s.addClass(l[i]),e.append(s),s.on("click",(function(t){t.stopPropagation(),e.find("div").removeClass("selected"),$(this).addClass("selected"),n.setStrokeWidth(a[i])}))}h.append(e)}if(i){let e=$(a),t=$(s);t.html("색상"),e.append(t);let o=i.list,r=["cBlack","cRed","cBlue","cGreen","cYellow","cWhite"];for(let t=0;t<o.length;t++){let s=$(l);t==i.def&&(u.addClass(r[t]),n.setStroke(o[t])),s.addClass(r[t]),e.append(s),s.on("click",(function(e){e.stopPropagation(),u.removeClass(r),u.addClass(r[t]),n.setStroke(o[t])}))}h.append(e)}let p=$('<div class="closeBtnDiv sUp"><i class="fal fa-angle-up"></i></div>');return p.addClass("z-100"),p.on("click",(function(e){$(".subDiv").slideUp(100),e.stopPropagation()})),h.append(p),h.hide(),n.open=function(){c.addClass("selected"),h.slideDown(100)},n.close=function(){h.slideUp(100)},this.element=c,c},select(){const e=this.element;e&&e.addClass("selected")},unselect(){const e=this.element;e&&(e.removeClass("selected"),e.find(".subDiv")?.slideUp())},pointerEnter(e){e.preventDefault();const t=this,i=t.getStyleAttribute(),n=e.currentTarget;$(n).attr("scale"),n.style.cursor="none";let s=n.closest("div").querySelector(".cursor");s&&s.remove(),s=document.createElement("div"),s.classList.add("cursor","draw");const o=i["stroke-width"];s.style.width=o+"px",s.style.height=o+"px",s.style.visibility="hidden";const r=i.stroke;s.style.borderColor=r,n.closest("div").appendChild(s),$(n).unbind("pointermove pointerdown wheel"),$(n).on("pointermove",(function(e){e.preventDefault();const t=Qe.getPointerPos(e,1,!0),i=(s.getBoundingClientRect(),t.y-o/2),n=t.x-o/2;s.style.top=i+"px",s.style.left=n+"px",s.style.visibility="visible"})),$(n).on("pointerdown",(function(e){t.pointerDown(e)})),t.cursorRemove=function(){s.remove()}},pointerDown(e){if(e.preventDefault(),null!=e.isPrimary&&!e.isPrimary)return;const t=this;t.close();const i=e.currentTarget,n=($(i).attr("scale"),e.pointerId),s=e.pointerType;if("touch"==s)return;const o=[];if(this.pointerType)switch(s){case"mouse":case"pen":o.length=0,t.drawCancel(),t.pointerId=n,t.pointerType=s;break;case"touch":return}else t.pointerId=n,t.pointerType=s;let r=Qe.getPointerPos(e,1);function a(e){if(document.elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset)!=i&&l(e),e.preventDefault(),e.pointerId!=t.pointerId)return;let n=Qe.getPointerPos(e,1);Qe.getDistance(r,n)<(t.strokeWidth/2<5?5:t.strokeWidth/2)||(o.push([n.x,n.y]),r=n,t.drawMove([n.x,n.y],o.slice(o.length-2,o.length),o))}function l(e){e.preventDefault(),$(i).unbind("pointerup",l),$(i).unbind("pointermove",a);const n=e.pointerId;e.pointerType,o.length>1&&(!n||t.pointerId==n)?t.drawEnd(o):t.drawCancel(),delete t.pointerType,delete t.pointerId}o.push([r.x,r.y]),t.drawStart([r.x,r.y]),$(i).on("pointermove",a),$(i).on("pointerup",l)},setName(e){this.name=e},setTitle(e){this.title=e}},tt={__proto__:et,icon:"fas fa-pen",size:{list:[2,4,6,8,10,12],def:1},color:{list:["#000000","#e90000","#0076e3","#00b100","#ffba00","#ffffff"],def:0},toContext(){return super.toContext()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){super.pointerEnter(e)},pointerDown(e){super.pointerDown(e)},createInterface(){return super.createInterface(this.icon,this.size,this.color)},setName(e){super.setName(e)},setTitle(e){super.setTitle(e)}},it={__proto__:et,icon:"fas fa-highlighter",size:{list:[10,25,50,75,100],def:1},color:{list:["#000000","#ff0000","#a1d9ff","#a1ffa1","#ffea8c"],def:3},toContext(){return super.toContext()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){super.pointerEnter(e)},pointerDown(e){super.pointerDown(e)},createInterface(){return super.createInterface(this.icon,this.size,this.color)},setName(e){super.setName(e)},setTitle(e){super.setTitle(e)}},nt={__proto__:et,icon:"fas fa-pen-fancy",size:{list:[5,10,15,20,25],def:0},color:{list:["#000000","#ff0000","#a1d9ff","#a1ffa1","#ffea8c"],def:0},toContext(){return super.toContext()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){super.pointerEnter(e)},pointerDown(e){super.pointerDown(e)},createInterface(){return super.createInterface(this.icon,this.size,this.color)},setName(e){super.setName(e)},setTitle(e){super.setTitle(e)}},st=new Be;Object.assign(st,nt),st.setName("fancy"),st.setTitle("펜시");const ot=st,rt={__proto__:Ze,toContext(){return{id:"G"+Qe.getUUID(6),action:"N",shape:new this.constructor(this)}},createInterface(){return super.createInterface()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){const t=this;e.preventDefault();const i=e.currentTarget;$(i).attr("scale"),$(i).css("cursor","crosshair"),$(i).unbind("pointermove pointerdown wheel"),$(i).on("pointerdown",(function(e){t.pointerDown(e)}))},pointerDown(e){if(e.preventDefault(),null!=e.isPrimary&&!e.isPrimary)return;const t=this,i=e.currentTarget,n=($(i).attr("scale"),Qe.getPointerPos(e,1));function s(e){e.preventDefault();const i=Qe.getPointerPos(e,1);t.drawMove?.(n,i)}function o(e){e.preventDefault(),$(i).unbind("pointerup",o),$(i).unbind("pointermove",s);const n=Qe.getPointerPos(e,1);t.drawEnd?.(n)}t.drawStart?.(n),$(i).unbind("pointerdown",o),$(i).on("pointermove",s),$(i).on("pointerup",o)},setName(e){this.name=e},setTitle(e){this.title=e}},at={__proto__:rt,icon:"far fa-text",toContext(){return super.toContext()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){super.pointerEnter(e)},pointerDown(e){super.pointerDown(e)},createInterface(){return super.createInterface(this.icon)},setName(e){super.setName(e)},setTitle(e){super.setTitle(e)}},lt={__proto__:rt,icon:"far fa-square-full",toContext(){return super.toContext()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){super.pointerEnter(e)},pointerDown(e){super.pointerDown(e)},createInterface(){return super.createInterface(this.icon)},setName(e){super.setName(e)},setTitle(e){super.setTitle(e)}},ct=new Ie;Object.assign(ct,lt),ct.setName("sqaure"),ct.setTitle("사각형");const dt=ct,ht=new _e({name:"pen",title:"펜",level:3});Object.assign(ht,tt),ht.setName("pen"),ht.setTitle("펜");const ut=ht,pt=new _e({strokeWidth:25,strokeOpacity:.5,level:1});Object.assign(pt,it),pt.setName("marker"),pt.setTitle("마커");const gt=pt,ft=new Ee({level:2});Object.assign(ft,at),ft.setName("textbox"),ft.setTitle("텍스트상자");const mt=ft,yt={__proto__:Ze,createInterface(){return super.createInterface()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){e.preventDefault();const t=e.currentTarget,i=this,n=$(t).attr("scale");t.style.cursor="none";let s=t.closest("div").querySelector(".cursor");s&&s.remove(),s=document.createElement("div"),s.classList.add("cursor","draw"),s.style.visibility="visible",s.style.width="20px",s.style.height="20px",s.style.borderColor="#999999",t.closest("div").appendChild(s),$(t).unbind("pointermove pointerdown wheel"),$(t).on("pointermove",(function(e){e.preventDefault();const t=Qe.getPointerPos(e,1,!0),i=(s.getBoundingClientRect(),t.y-10),n=t.x-10;s.style.top=i+"px",s.style.left=n+"px"})),$(t).on("pointerdown",(function(e){i.pointerDown(e,n)})),i.cursorRemove=function(){s.remove()}},pointerDown(e,t){const i=this;if(e.preventDefault(),e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId),null!=e.isPrimary&&!e.isPrimary)return;if("touch"==e.pointerType)return;const n=e.currentTarget,s=e.target;let o=Qe.getPointerPos(e,1,!0);function r(e){e.preventDefault();const t=e.target;o=Qe.getPointerPos(e,1,!0),i.erase([o.x,o.y],t)}s!=n&&i.erase([o.x,o.y],s),$(n).on("pointermove",r),$(n).on("pointerup",(function e(t){t.preventDefault(),$(n).unbind("pointerup",e),$(n).unbind("pointermove",r),i.eraseEnd()}))}},vt=new Xe({name:"eraser",title:"지우개",icon:"fas fa-eraser"});Object.assign(vt,yt);const bt=vt;class wt extends We{constructor(e={}){super(e);const{node:t=null,color:i="#fff",wradius:n=16,hradius:s=16}=e;this.node=t,this.wradius=n,this.hradius=s,this.color=i,this.posX=0,this.posY=0}update(e={}){const{node:t=this.node,color:i=this.color,wradius:n=this.wradius,hradius:s=this.hradius}=e;this.node=t,this.wradius=n,this.hradius=s,this.color=i}updatePos(e={}){const{posX:t=this.posX,posY:i=this.posY}=e;this.posX=t,this.posY=i}startDraw(){const e=this;this.endDraw(),this.interval=setInterval((function(){!function(e={}){const{node:t,wradius:i,hradius:n,color:s,posX:o,posY:r}=e;$(t).children("#laserCircle").length<=0?$('<div class="laserCircle" id="laserCircle"></div>').css({position:"absolute",width:i,height:n,"border-radius":"50%",background:s,border:"3px solid"+s,top:r-n/2+"px",left:o-i/2+"px","touch-action":"none","pointer-events":"none"}).appendTo(t):($("#laserCircle"),$("#laserCircle").finish().css({top:r-n/2+"px",left:o-i/2+"px",opacity:1,display:"block"}))}({node:e.node,wradius:e.wradius,hradius:e.hradius,color:e.color,posX:e.posX,posY:e.posY})}),10)}endDraw(){$("#laserCircle").fadeOut("slow",(function(){})),clearInterval(this.interval)}}const Ct={__proto__:Ze,createInterface(){return super.createInterface()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){e.preventDefault();const t=e.currentTarget,i=$(t).attr("scale");$(t).unbind("wheel"),$(t).css("cursor","grab");const n=new kt({tool:this,scale:i});$(t).on("pointerdown",(function(e){e.stopPropagation(),e.preventDefault(),$(t).css("cursor","grabbing"),n.controlStart(e)})),$(t).on("pointermove",(function(e){e.stopPropagation(),e.preventDefault(),$(t).css("cursor","grab"),n.controlMove(e)})),$(t).on("pointerup",(function(e){e.stopPropagation(),e.preventDefault(),$(t).css("cursor","grabbing"),n.controlEnd(e)}))}};class kt{constructor(e={}){const{tool:t,scale:i=1}=e;this.tool=t,this.evCache=[],this.lastPos=[],this.totalMove=0,this.grab=!1}controlStart(e,t){this.prevDiff=-1,this.startTime=e.timeStamp,e.currentTarget;const i=Qe.getPointerPos(e,1);this.totalMove=0,this.lastPos=i,this.evCache.push(e),this.tool.controlStart?.(e,i)}controlMove(e,t){e.preventDefault(),e.stopPropagation();const i=this.evCache;if(0!=i.length){for(let t=0;t<i.length;t++)if(e.pointerId===i[t].pointerId){i[t]=e;break}if(2===i.length){const e=Math.abs(i[0].clientX-i[1].clientX),t=this.prevDiff;t>0&&(e>t&&this.tool.zoom("in",e-t),e<t&&this.tool.zoom("out",t-e)),this.prevDiff=e}else{const t=this.lastPos,i=Qe.getPointerPos(e,1);if(!t)return void(this.lastPos=i);let n=Qe.getDistance(t,i);if(n<=0)return;this.totalMove+=n,this.tool.controlMove?.(e,t,i,n),this.direction=t.y-i.y>0?"bottom":"top",this.lastPos=null}}}controlEnd(e,t){if(e.preventDefault(),e.stopPropagation(),!e.pointerId)return;!function(e,t){for(let i=0;i<t.length;i++)if(t[i].pointerId===e.pointerId){t.splice(i,1);break}}(e,this.evCache),this.evCache.length<2&&(this.prevDiff=-1),this.lastPos=null;const i=Qe.getPointerPos(e,1),n=e.timeStamp,s=Math.floor(n-this.startTime);this.tool.controlEnd?.(i,this.totalMove,this.direction,s)}scroll(e,t){this.tool.scroll(e,Qe.roundToTwo(t))}}const Et={__proto__:Ct,toContext(){return super.toContext()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()},pointerEnter(e){const t=this;e.preventDefault();const i=e.currentTarget;$(i).css("cursor","default"),$(i).unbind("click wheel pointermove pointerdown"),$(i).on("pointerdown",(function(e){e.stopPropagation(),e.preventDefault(),t.pointerDown(e)}))},pointerDown(e){const t=this,i=(e.timeStamp,e.currentTarget);i.setPointerCapture(e.pointerId);const n=Qe.getPointerPos(e,1);let s=n;function o(e){e.preventDefault(),e.stopPropagation();const i=Qe.getPointerPos(e,1);Qe.getDistance(s,i)<=1||(t.laserMove?.(i),s=i)}$(i).on("pointermove",o),$(i).on("pointerup",(function n(s){i.releasePointerCapture(e.pointerId),s.preventDefault(),s.stopPropagation(),$(i).unbind("pointerup",n),$(i).unbind("pointermove",o),t.laserEnd?.()})),t.laserStart?.(n)},createInterface(){return super.createInterface()}},Tt=new wt({name:"laser",title:"레이저포인터",icon:"fas fa-bullseye-pointer",color:"#e9000066",wradius:40,hradius:40});Tt.setType("highlight"),Object.assign(Tt,Et);const St=Tt,xt=new We({name:"pointer",title:"포커스",icon:"fas fa-hand-paper"});Object.assign(xt,Ct);const Lt=xt,Dt={__proto__:Ze,createInterface(){return super.createInterface()},select(){},unselect(){},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()}},Nt={__proto__:Ze,createInterface(){return super.createInterface()},select(){super.select()},unselect(){super.unselect()},enable(){super.enable()},disable(){super.disable()},show(){super.show()},hide(){super.hide()}},Mt=new Ve({name:"zoomout",title:"축소",icon:"fas fa-search-minus",zoom:"out"});Object.assign(Mt,Dt);const Pt=Mt,$t=new Ve({name:"zoomin",title:"확대",icon:"fas fa-search-plus",zoom:"in"});Object.assign($t,Dt);const Ot=$t,_t=new Je({name:"fitver",title:"세로맞춤",icon:"fas fa-arrows-alt-v",fit:"vertical"});Object.assign(_t,Nt);const Bt=_t,Kt=new Je({name:"fithor",title:"가로맞춤",icon:"fas fa-arrows-alt-h",fit:"horizontal"});Object.assign(Kt,Nt);const It=Kt;class At{constructor(e={}){const{unuse:t=[ot,dt]}=e,i=t,n=[ut,gt,ot,dt,mt,bt,St,Lt,Pt,Ot,Bt,It].filter((e=>!i.includes(e)));this.toolCollection=n.map((e=>{return t=e,Object.assign(Object.create(Object.getPrototypeOf(t)),t);var t})),this.pathToolCollection=this.toolCollection.filter((e=>e instanceof Oe)),this.basicToolCollection=this.toolCollection.filter((e=>e instanceof ke)),this.eraserToolCollection=this.toolCollection.filter((e=>e instanceof Xe)),this.controlToolCollection=this.toolCollection.filter((e=>e instanceof We)),this.resizeToolCollection=this.toolCollection.filter((e=>e instanceof Ve||e instanceof Je));const s=this;this.pathToolCollection.forEach((e=>e.on("select",(function(){s.pathToolCollection.filter((e=>e!=this)).forEach((e=>e.unselect())),s.basicToolCollection.forEach((e=>e.unselect())),s.eraserToolCollection.forEach((e=>e.unselect())),s.controlToolCollection.forEach((e=>e.unselect())),e.select()})))),this.basicToolCollection.forEach((e=>e.on("select",(function(){s.pathToolCollection.forEach((e=>e.unselect())),s.basicToolCollection.filter((e=>e!=this)).forEach((e=>e.unselect())),s.eraserToolCollection.forEach((e=>e.unselect())),s.controlToolCollection.forEach((e=>e.unselect())),e.select()})))),this.eraserToolCollection.forEach((e=>e.on("select",(function(){s.pathToolCollection.forEach((e=>e.unselect())),s.basicToolCollection.forEach((e=>e.unselect())),s.eraserToolCollection.filter((e=>e!=this)).forEach((e=>e.unselect())),s.controlToolCollection.forEach((e=>e.unselect())),e.select()})))),this.controlToolCollection.forEach((e=>e.on("select",(function(){s.pathToolCollection.forEach((e=>e.unselect())),s.basicToolCollection.forEach((e=>e.unselect())),s.eraserToolCollection.forEach((e=>e.unselect())),s.controlToolCollection.filter((e=>e!=this)).forEach((e=>e.unselect())),e.select()})))),this.resizeToolCollection.forEach((e=>e.on("select",(function(){s.resizeToolCollection.filter((e=>e!=this)).forEach((e=>e.unselect())),e.select()})))),this.interfaceCollection=this.toolCollection.map((e=>e.createInterface()))}selectTool(e){this.unselectAll();const t=this.toolCollection.find((t=>t.name==e));return t?(t.trigger("select"),t):ut}unselectAll(){this.toolCollection.forEach((e=>e.unselect()))}getTool(e){return this.toolCollection.find((t=>t.name==e))}getAllTool(){return this.toolCollection}getPathTool(){return this.pathToolCollection}getBasicTool(){return this.basicToolCollection}getEraserTool(){return this.eraserToolCollection}getControlTool(){return this.controlToolCollection}getResizeTool(){return this.resizeToolCollection}getToolInterface(){return this.interfaceCollection}}const Ft={ResizeFactor:function(e){const t={x:0,y:0,width:0,height:0};switch(e){case"nw":t.x=1,t.y=1,t.width=-1,t.height=-1;break;case"ne":t.x=0,t.y=1,t.width=1,t.height=-1;break;case"sw":t.x=1,t.y=0,t.width=-1,t.height=1;break;case"se":t.x=0,t.y=0,t.width=1,t.height=1;break;case"n":t.x=0,t.y=1,t.width=0,t.height=-1;break;case"s":t.x=0,t.y=0,t.width=0,t.height=1;break;case"e":t.x=0,t.y=0,t.width=1,t.height=0;break;case"w":t.x=1,t.y=0,t.width=-1,t.height=0}return t},DefaultFontFamily:"HelveticaNeue-Light,AppleSDGothicNeo-Light,Pretendard,Malgun Gothic,맑은 고딕,sans-serif"};class Ht{constructor(e={}){const t={selectable:!0,disableTool:[],hideTool:["highlight"]},{width:i=300,height:n=150,section:o=null,options:r=t}=e;if(this.options=r,this.mutex=new s,!o||""==o)return console.error("캔버스가 위치할 선택자 혹은 DOM이 설정되어 있지 않습니다."),null;this.sectionNode="string"==typeof o?document.querySelector("#"+o):o,Rt.call(this),jt.call(this),Gt.call(this),qt.call(this,{width:i,height:n}),Yt.call(this,r)}update(e={}){const{options:t={}}=e;Yt.call(this,t)}start(){const e=this,t=this.containerNode;if($(t).on({pointerenter:function(t){t.stopPropagation(),t.preventDefault(),1!=e.nowEnter&&(Ut.call(e,t),e.nowEnter=!0)},pointerleave:function(t){t.stopPropagation(),t.preventDefault(),zt.call(e,t),e.nowEnter=!1}}),this.eventTool){const e=this.eventObject;Ut.call(this,e)}}stop(){const e=this;return new Promise(((t,i)=>{const n=e.containerNode;n.style.cursor="default",e.laserEnd(),e.eventTool?.cursorRemove?.(),e.editService.stopEdit(),$(n).trigger("pointerup"),$(n).unbind("pointerdown pointerenter pointermove pointerup pointerleave"),setTimeout((()=>t()))}))}clear(){this.editService.stopEdit(),this.graphicService.empty(),this.screenService.transformScale(),this.screenService.setBackgroundColor()}fitScreenToWindow(){this.screenService.fitScreenToWindow()}fitVerticalOrientation(){this.screenService.fitVerticalOrientation()}fitHorizontalOrientation(){this.screenService.fitHorizontalOrientation()}setFocus(){}setBackground(e={}){return new Promise((async(t,i)=>{const{url:n=null,color:s="white"}=e;if(n)try{await this.screenService.setBackgroundImage(n)}catch(e){i(e)}else this.screenService.setBackgroundColor(s);t()}))}getSourceImg(){return this.screenService.image}isEmpty(){return this.graphicService.isEmpty()}getPadImage(){const e=this;return new Promise(((t,i)=>{e.editService.stopEdit();const n=e.getSourceImg();ei.call(e).then((function(e={}){const{canvas:i,ctx:s}=e;n&&(s.globalCompositeOperation="destination-over",s.drawImage(n,0,0,i.width,i.height));let o=i.toDataURL();t(o)}))}))}selectTool(e){this.toolService.selectTool(e),zt.call(this),Ut.call(this)}disableTool(e){const t=this;e.forEach((e=>{t.toolService.getTool}))}getToolInterface(){return this.toolService.getToolInterface()}loadGraphicContext(e){return new Promise(((t,i)=>{this.graphicService.empty();for(const t of e)this.graphicHistory.take(),this.graphicService.load(t);t(this.graphicService.getAll())}))}getGraphicContext(){return this.graphicService.getAll().map((e=>JSON.stringify(e)))}undo(){this.mutex.runExclusive((async()=>{this.editService.stopEdit(),this.graphicHistory.undo()}))}redo(e){this.mutex.runExclusive((async()=>{this.editService.stopEdit(),this.graphicHistory.hasRedo()?this.graphicHistory.redo():(this.graphicHistory.take(),this.graphicService.load(e))}))}laserStart(e){const t=this.toolService.getTool("laser");t?.update({node:this.containerNode}),t?.updatePos({posX:e.x,posY:e.y}),t?.startDraw(),this.laser=t}laserMove(e){$(this.containerNode).children("#laserCircle").length<=0?this.laserStart(e):this.laser?.updatePos({posX:e.x,posY:e.y})}laserEnd(){this.laser?.endDraw(),delete this.laser}}function Rt(){const e=this.sectionNode;e.setAttribute("node-role","section");const t=document.createElement("div");t.setAttribute("node-role","screen"),e.appendChild(t),e.screenNode=t,this.screenNode=t;const i=document.createElement("div");i.setAttribute("node-role","container"),t.appendChild(i),t.containerNode=i,this.containerNode=i;const n=Se.createElementNS("svg",{role:"area"});n.style.overflow="hidden",n.setAttribute("node-role","deploy");const s=Se.createElementNS("g",{role:"depth","depth-level":1}),o=Se.createElementNS("g",{role:"depth","depth-level":2}),r=Se.createElementNS("g",{role:"depth","depth-level":3}),a=[s,o,r];n.appendChild(s),n.appendChild(o),n.appendChild(r),n.getDeployNode=e=>(e>3?e=3:e<1&&(e=1),a[e-1]),n.addGraphic=(e={})=>{const{element:t,level:i=1}=e;i>3?i=3:i<1&&(i=1),a[i-1].appendChild(t)},n.clearGraphic=()=>{a.forEach((e=>e.innerHTML=""))},i.appendChild(n),i.svgNode=n,this.svgNode=n}function Ut(e){const t=this.eventTool;e&&(this.eventObject=e),this.eventObject&&this.eventCallback?.call(t,this.eventObject)}function zt(e){const t=this.eventTool;t?.cursorRemove?.();const i=this.containerNode;$(i).trigger("pointerup"),$(i).unbind("pointerdown pointermove pointerup"),$(i).css("cursor","default")}function Yt(e={}){const{selectable:t=this.options.selectable,disableTool:i=this.options.disableTool,hideTool:n=this.options.hideTool}=e;this.options.selectable=t,this.options.disableTool=i,this.options.hideTool=n,this.svgNode,1==t?document.querySelectorAll("svg").forEach((e=>e.setAttribute("pointer-events","visiblePainted"))):document.querySelectorAll("svg").forEach((e=>e.setAttribute("pointer-events","none")));const s=this.toolService.getAllTool();s.forEach((e=>{e.enable(),e.show()})),s.filter((e=>i.includes(e.type))).forEach((e=>e.disable())),s.filter((e=>n.includes(e.type))).forEach((e=>e.hide()))}function qt(e={}){const t=this,{width:i,height:n}=e,s=new we({instance:t,width:i,height:n});s.on("transformScale",(function(e){t.trigger("transformScale",e)})),this.screenService=s}function jt(){const e=new Ae({instance:this});this.graphicService=e;const t=new Fe(e);this.graphicHistory=t}function Gt(){const e=this;this.editService=new Ue({rootNode:e.containerNode,svgNode:e.svgNode}),this.toolService=new At,e.editService.on("deleteElem",(t=>{e.editService.stopEdit(),e.graphicHistory.take(),e.graphicService.remove(t),e.trigger("addContext",{id:t,action:"D"})})),e.editService.on("changeFontSize",((t,i)=>{e.graphicHistory.take(),t.shape.update({fontSize:i}),e.trigger("addContext",{id:t.id,action:"U",shape:{fontSize:i}})})),e.editService.on("changeFontColor",((t,i)=>{e.graphicHistory.take(),t.shape.update({color:i}),e.trigger("addContext",{id:t.id,action:"U",shape:{color:i}})})),e.editService.on("changeText",((t,i)=>{t.shape.getText()!=i&&(e.graphicHistory.take(),t.shape.update({text:i}),e.trigger("addContext",{id:t.id,action:"U",shape:{text:i}}))})),e.toolService.getAllTool().forEach((t=>t.on("select",(function(){t instanceof Ve?"in"==t.zoom?e.screenService.zoomin():"out"==t.zoom&&e.screenService.zoomout():t instanceof Je?"horizontal"==t.fit?e.screenService.fitHorizontalOrientation():"vertical"==t.fit&&e.screenService.fitVerticalOrientation():(e.editService.stopEdit(),e.screenService.switchCtrlmode(!1),e.screenService.switchErasermode(!1),t instanceof _e?(e.eventTool=t,e.eventCallback=t.pointerEnter,Xt.call(e,t)):t instanceof Be?(e.eventTool=t,e.eventCallback=t.pointerEnter,Wt.call(e,t)):t instanceof ke?(e.eventTool=t,e.eventCallback=t.pointerEnter,Vt.call(e,t)):t instanceof Xe?(e.eventTool=t,e.eventCallback=t.pointerEnter,e.screenService.switchErasermode(!0),Jt.call(e,t)):t instanceof We&&(e.eventTool=t,e.eventCallback=t.pointerEnter,e.screenService.switchCtrlmode(!0),t instanceof wt?Qt.call(e,t):Zt.call(e,t)))}))))}function Xt(e){const t=this,i=t.svgNode;let n,s,o;e.drawStart=function(r){let a=[];if(a.push(r),n)clearTimeout(n),n=null,o.push(a);else{t.graphicHistory.dump(),o=[],o.push(a);const n=e.toContext();s=t.graphicService.create(n),s.setLevel(e.getLevel()),i.appendChild(s.getPackedElem())}e.drawMove=function(e,t,i){a.push(e),s.shape.update({pointGroup:o})},e.drawEnd=function(e){n=setTimeout((()=>{const e=s.toContext();t.graphicHistory.take(),t.graphicService.insert(s),t.trigger("addContext",{...e,action:"N"}),n=null}),200)},e.drawCancel=function(){o.pop(),s.shape.update({pointGroup:o})}}}function Wt(e){const t=this,i=t.svgNode;e.drawStart=function(n){t.graphicHistory.dump();const s=e.toContext(),o=t.graphicService.create(s);o.setLevel(e.getLevel()),i.appendChild(o.getPackedElem()),e.drawMove=function(e,t,i){o.shape.update({pointGroup:i})},e.drawEnd=function(e){const i=o.toContext();t.graphicHistory.take(),t.graphicService.insert(o),t.trigger("addContext",{...i,action:"N"})},e.drawCancel=function(){o.destroy()}}}function Vt(e){const t=this,i=t.svgNode;e.drawStart=function(n){t.graphicHistory.dump();const s=e.toContext(),o=t.graphicService.create(s);o.setLevel(e.getLevel()),i.appendChild(o.getPackedElem());let r=0,a=0;e.drawMove=function(e,t){r=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y),o.shape.update({startPos:[e.x,e.y],endPos:[t.x,t.y],strokeDasharray:r<40||a<20?"6 4":""})},e.drawEnd=function(e){o.shape.update({stroke:"none"}),(r<40||a<20)&&o.shape.update({startPos:[n.x,n.y],endPos:[n.x+300,n.y+100],strokeDasharray:""});const i=o.toContext();t.graphicHistory.take(),t.graphicService.insert(o),t.trigger("addContext",{...i,action:"N"}),t.selectTool("pointer"),t.graphicService.select(o.id),t.editService.startEdit(o)},e.drawCancel=function(){trigger("cancelStroke")}}}function Jt(e){const t=this;t.svgNode,e.erase=function(e,i){t.mutex.runExclusive((async()=>{if("path"!=i.nodeName&&"polyline"!=i.nodeName)return;const e=i.closest('g[role="container"]'),n=e.id;t.graphicHistory.dump(),t.graphicService.remove(n)?(t.graphicHistory.take(),t.trigger("addContext",{id:n,action:"D"})):e.remove()}))},e.eraseEnd=function(){t.graphicService.runGarbageCollector()}}function Qt(e){const t=this;e.laserStart=function(i){const n=e;n.update({node:t.containerNode}),n.updatePos({posX:i.x,posY:i.y}),n.startDraw(),t.trigger("laserStart",i),e.laserMove=function(e){n.updatePos({posX:e.x,posY:e.y}),t.trigger("laserMove",e)},e.laserEnd=function(){n.endDraw(),t.trigger("laserEnd")}}}function Zt(e){const t=this;t.svgNode;let i=null,n=null,s=null;e.scroll=function(e,o){n?clearTimeout(n):(s=o,i=t.sectionNode.scrollTop),n=setTimeout((()=>{const r=o-s;n=null,t.sectionNode.scrollTop==i&&r<40&&t.trigger("swipe",e)}),100)},e.controlStart=function(i,n){const s=i.target,o=s.getAttribute("role");let r=t.sectionNode.scrollTop;if(s==t.containerNode||s==t.svgNode)t.editService.stopEdit(),e.controlMove=function(i,n,s,o){const r=t.screenService.scale,a=n.x-s.x,l=n.y-s.y;t.sectionNode.scrollLeft+=a*r,t.sectionNode.scrollTop+=l*r,t.trigger("pointerMove",e,[s.x,s.y])},e.controlEnd=function(e,i,n,s){t.editService.show();let o=t.sectionNode.scrollTop;o==r&&s<125&&i>100&&t.trigger("swipe",n),r=o},e.zoom=function(e,i){"in"==e?t.screenService.zoomin(.01):t.screenService.zoomout(.01)};else if("boundary-vertex"==o)t.sectionNode.style.overflow="none",t.sectionNode.style.touchAction="none",function(i,n,s){t.graphicHistory.dump(),t.editService.hide();const o=t.graphicService.getSelected(),r=o.getPackedElem().getBBox(),a=o.shape,l=a.posX,c=a.posY,d=r.x,h=r.y,u=d-l,p=h-c,g=r.width,f=r.height,m=Ft.ResizeFactor(s);"path"==a.type?(e.controlMove=function(e,i,s,r){const a=t.screenService.width,d=t.screenService.height,h=s.x-n.x,y=s.y-n.y,v=l+h*m.x,b=c+y*m.y,w=g+h*m.width,C=f+y*m.height;v+u<0||b+p<0||w<40||C<20||v+u+w>a||b+p+C>d||o.shape.update({posX:v,posY:b,width:w,height:C})},e.controlEnd=function(e,i,n){t.editService.show(),t.graphicHistory.take(),t.trigger("addContext",{id:o.id,action:"U",shape:{posX:a.posX,posY:a.posY,width:a.width,height:a.height}})}):(e.controlMove=function(e,i,s,r){const a=t.screenService.width,l=t.screenService.height;let c=s.x-n.x,u=s.y-n.y,p=d+c*m.x,y=h+u*m.y,v=g+c*m.width,b=f+u*m.height,w=[p,y],C=[p+v,y+b];p<0||y<0||v<40||b<20||p+v>a||y+b>l||o.shape.update({posX:0,posY:0,startPos:w,endPos:C})},e.controlEnd=function(e,i,n){t.editService.show(),t.graphicHistory.take(),t.trigger("addContext",{id:o.id,action:"U",shape:{posX:0,posY:0,startPos:a.startPos,endPos:a.endPos}})})}(0,n,s.getAttribute("resize-direction"));else if("boundary-box"==o)t.sectionNode.style.overflow="none",t.sectionNode.style.touchAction="none",function(i,n){t.graphicHistory.dump(),t.editService.hide();const s=t.graphicService.getSelected(),o=s.getPackedElem().getBBox(),r=s.shape,a=r.posX,l=r.posY,c=o.x,d=o.y,h=c-a,u=d-l,p=o.width,g=o.height;e.controlMove=function(e,i,o,r){const c=o.x-n.x,d=o.y-n.y,f=t.screenService.width,m=t.screenService.height;let y=a+c,v=l+d;y=h+y<0?-1*h:y,v=u+v<0?-1*u:v,y=y+h+p>f?f-(p+h):y,v=v+u+g>m?m-(g+u):v,s.shape.update({posX:y,posY:v})},e.controlEnd=function(e,i,n){t.editService.show(),t.graphicHistory.take(),t.trigger("addContext",{id:s.id,action:"U",shape:{posX:r.posX,posY:r.posY}})}}(0,n);else try{delete e.controlMove,delete e.controlEnd;const i=s.closest('g[role="container"]'),n=t.graphicService.select(i.id);t.editService.startEdit(n)}catch(e){}}}function ei(){const e=this;return new Promise(((t,i)=>{const n=e.svgNode,s=document.createElement("canvas");s.width=n.getAttribute("width"),s.height=n.getAttribute("height");const o=s.getContext("2d"),r=e.graphicService.getAll();for(const e of r)if("textarea"==e.getShape().type){e.getGraphicElem();const t=e.getForeignElem().querySelector("textarea"),i=window.getComputedStyle(t);Array.from(i).forEach((e=>t.style.setProperty(e,i.getPropertyValue(e),"important"))),t.innerHTML=t.value}const a=new Image;a.crossOrigin="*",a.onload=function(){o.drawImage(this,0,0,s.width,s.height),t({canvas:s,ctx:o})};const l="data:image/svg+xml; charset=utf8, "+encodeURIComponent(function(e){const t="http://www.w3.org/2000/xmlns/";e=e.cloneNode(!0);const i=window.location.href+"#",n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);for(;n.nextNode();)for(const e of n.currentNode.attributes)e.value.includes(i)&&(e.value=e.value.replace(i,"#"));e.setAttributeNS(t,"xmlns","http://www.w3.org/2000/svg"),e.setAttributeNS(t,"xmlns:xlink","http://www.w3.org/1999/xlink");return(new XMLSerializer).serializeToString(e)}(n));a.src=l}))}Object.assign(Ht.prototype,be);const ti={notePageLength:(e={})=>{const{meetingKey:t,fileKey:i}=e;return P(`/api/ewp/meeting/${t}/note/${i}/length`)},notePageSourceImage:(e={})=>{const{meetingKey:t,fileKey:i,pageNo:n}=e;return`/api/ewp/meeting/${t}/note/${i}/page/${n}/image/source`},notePageDrawImage:(e={})=>{const{meetingKey:t,fileKey:i,pageNo:n,salt:s}=e;return`/api/ewp/meeting/${t}/note/${i}/page/${n}/image/draw?salt=${s}`},memoPageLength:e=>P(`/api/ewp/meeting/${e}/memo/length`),memoSourceImage:(e={})=>{const{meetingKey:t}=e;return`/api/ewp/meeting/${t}/memo/page/image/source`},memoPageDrawImage:(e={})=>{const{meetingKey:t,pageNo:i,salt:n}=e;return`/api/ewp/meeting/${t}/memo/page/${i}/image/draw?salt=${n}`}},ii={memoPage:(e={})=>{const{meetingKey:t,pageNo:i}=e;return O(`/api/ewp/meeting/${t}/memo/page/${i}`)}},ni={notePage:(e={})=>{const{meetingKey:t,fileKey:i,pageNo:n,image:s}=e;return _(`/api/ewp/meeting/${t}/note/${i}/page/${n}/image/draw`,{data:s,headers:{"Content-Type":"application/json; charset=utf-8"}})},memoPage:(e={})=>{const{meetingKey:t,pageNo:i,image:n}=e;return _(`/api/ewp/meeting/${t}/memo/page/${i}/image/draw`,{data:n,headers:{"Content-Type":"application/json; charset=utf-8"}})}},si=function(e){const t=e.loginKey,i=e.meetingKey,n=(e.getFileService(),new s),o=new ve({DB_NAME:t+"_"+i+"_DRAWING_ARCHIVE"});let r,a,l,c,u,p=[],g=[],f="",m=$(".thumbnailDiv").show(),v={file:null,fileKey:0,pageno:0,pageLength:0,allPageList:[],bmPageList:[]};function b(){a.on("addContext",C),a.on("swipe",k)}function w(){a.off("addContext",C),a.off("swipe",k)}async function C(e){const t=v.pageno;e.page=t,await o.insert(v.fileKey,e),g=[],p.push(e),I()}function k(e){"top"==e?$("#prev").trigger("click"):"bottom"==e&&$("#next").trigger("click")}async function E(e={}){return new Promise((async(t,n)=>{const{file:s=v.file,pageno:c=1,save:d=!0}=e;if(null==s||null==c)return void n();R();let h=!1,u=!1;if(v.file!=s?(h=!0,u=!0):v.pageno!=c&&(u=!0),h||u)try{if(y.startLoading(),await a.stop(),r.trigger("selectFile",s.fileKey,c),v.pageno&&d&&await j(),h&&("MEMO"==s?(await async function(){return new Promise((async(e,t)=>{try{v.file="MEMO",v.fileKey="MEMO",await o.setStore("MEMO"),await T();const t=await ti.memoPageLength(i);v.pageLength=t,S(),$(".list.thumbnailDiv").empty(),$(".list.bookmarkDiv").empty(),$(".thumbnailBtnDiv div").removeClass("disabled"),e()}catch(e){t(e)}}))}(),await D("MEMO"),a.selectTool("pen")):(await async function(e,t){return new Promise((async(t,i)=>{try{v.file=e,v.fileKey=e.fileKey,await o.setStore(e.fileKey),await T();const i=e.page;v.pageLength=i,S(),$(".list.thumbnailDiv").empty(),$(".list.bookmarkDiv").empty(),$(".thumbnailBtnDiv div").removeClass("disabled"),t()}catch(e){i(e)}}))}(s),await D(s.fileKey),a.selectTool("pointer")),U()),u){try{await function(e){return new Promise((async function(t,n){v.pageno=e||1;const s=v.fileKey,r=$(".list.thumbnailDiv"),l=$(".list.bookmarkDiv");let c;await async function(){let e=v.pageno;const t=await o.getDataFromIndex(v.fileKey,"page",e);await a.loadGraphicContext(t);const i=a.getGraphicContext(),n=new Checksum("fnv32",0);n.updateStringly(i),f=n.result.toString(16)}(),c="MEMO"==s?ti.memoSourceImage({meetingKey:i}):ti.notePageSourceImage({meetingKey:i,fileKey:s,pageNo:e}),a.setBackground({url:c}).then((function(){$("#currentPage").val(e),r.find("li").removeClass("selected"),r.find("#tm"+e).addClass("selected"),l.find("li").removeClass("selected"),l.find("#bm"+e).addClass("selected"),t()})).catch((function(e){n(e)}))}))}(c)}catch(e){n(e)}"MEMO"==s?await O(c):await N(s.fileKey,c),setTimeout((()=>{const e=document.querySelectorAll('li[data-page="'+c+'"]');for(const t of e)t.classList.add="selected",t.scrollIntoView({behavior:"smooth",block:"center"})}))}h&&a.fitScreenToWindow(),a.start(),y.endLoading(),l.show(c+"페이지")}catch(e){y.endLoading(),n(e)}H(),t()}))}async function T(){const e=await o.getAllData(v.fileKey);console.log("loadFileGraphicContext","fileKey",v.fileKey,"GraphicContext",e),e&&(p=e,g=[]),I()}function S(){const e=v.pageLength,t=v.pageno;let i=[];for(let t=1;t<=e;t++)i.push(t);v.allPageList=i,v.bmPageList=i,c=i,$(".docuToolDiv").removeClass("d-none");const n=$(".docuPagingDiv"),s=n.find("#currentPage");s.val(i.indexOf(t)+1),n.find("i").unbind("click"),$("#tot").html("/ "+e),s[0].oninput=e=>{((e,t={})=>{e.value.length>=e.maxLength&&(t.returnValue=!1),e.value=e.value.replace(/[^0-9]/g,"").replace(/(\..*)\./g,"$1"),e.value=e.value.replace(" ","")})(s[0])},x()}function x(){$(".docuPagingDiv").removeClass("d-none"),function(){async function e(e){y.startLoading();const t=v.fileKey;$(".thumbnailDiv"),"MEMO"==t?await O(e):await N(t,e);try{await E({pageno:c[e-1]}),setTimeout((()=>{const t=m.find("[data-page="+e+"]");t.addClass("selected"),t[0].scrollIntoView({behavior:"smooth",block:"center"})}))}catch(e){y.error({response:e})}y.endLoading()}$("#backward").unbind("click"),$("#forward").unbind("click"),$("#next").unbind("click"),$("#prev").unbind("click"),$("#currentPage").unbind("change"),$("#backward").on("click",(function(){e(1)})),$("#forward").on("click",(function(){e(v.pageLength)})),$("#next").on("click",(function(){const t=v.pageLength;let i=Number($("#currentPage").val())+1;Number($("#currentPage").val())>=t&&(i=t),e(i)})),$("#prev").on("click",(function(){let t=Number($("#currentPage").val())-1;Number($("#currentPage").val())<=1&&(t=1),e(t)})),$("#currentPage").on("change",(function(){const t=v.pageLength;let i=$(this).val();i>t?i=t:i<1&&(i=1),$(this).val(i),e(i)}))}()}function L(){$(".docuPagingDiv").addClass("d-none")}async function D(e){const t=await o.getBookmark(e);if(t&&0!=t.length){t.sort(((e,t)=>e-t));for(let i=0;i<t.length;i++){const n=t[i];let s="MEMO"==e?B({pageno:n,includeOption:!1}):P(e,n);s.addClass("bookmark"),s.attr("id","bm"+n),$(".list.bookmarkDiv").append(s)}}}async function N(e,t){R(),F();const i=d(".list.thumbnailDiv");for(;;){const s=i.children.length+1,o=z(s,10);if(t<s||s>o)break;await M(e,s,o),(n=i).scrollHeight>n.clientHeight||await N(e,t+10)}var n;H()}function M(e,t,i){return new Promise((async(n,s)=>{const r=await o.getBookmark(e);v.bmPageList=r;const a=[];for(let n=t;n<=i;n++){let t=n,i=P(e,t);a.push(i),v.pageno==n&&i.addClass("selected"),i.attr("id","tm"+t),$(".list.thumbnailDiv").append(i),r&&r.includes(t)&&i.addClass("bookmark")}const l=setInterval((()=>{1==a.reduce(((e,t)=>e&&t.load),!0)&&(clearInterval(l),n())}),100)}))}function P(e,t){let n=Y,s=$(n.imgCon),o=$(n.img);s.html(o),s.attr("data-page",t);const r=ti.notePageDrawImage({meetingKey:i,fileKey:e,pageNo:t,salt:f});return o.attr("src",r),s.load=!1,o.on("load",(()=>{s.load=!0})),s.on("click",(async function(){try{E({pageno:t})}catch(e){y.error({response:e})}})),s}async function O(e){for(R();;){let t=$(".list.thumbnailDiv").children().length+1,i=z(t,9999);if(await _(t,i),e<t||t>i)break}!function(){$(".addPaper").remove();const e=$('<li><div class="addPaper">+</div></li>');$(".list.thumbnailDiv").append(e),e.css("cursor","pointer"),e.on("click",(async function(){K(v.pageLength+1)}))}(),F(),H()}function _(e,t){return new Promise((async(i,n)=>{const s=await o.getBookmark("MEMO");v.bmPageList=s;for(let i=e;i<=t;i++){let e=i,t=B({pageno:e});v.pageno==i&&t.addClass("selected"),t.attr("id","tm"+e),$(".list.thumbnailDiv").append(t),s&&s.includes(e)&&t.addClass("bookmark")}i()}))}function B(e={}){const{pageno:t=1,includeOption:n=!0}=e;let s=Y,r=$(s.imgCon),a=$(s.img);r.html(a),r.attr("data-page",t);const l=ti.memoPageDrawImage({meetingKey:i,pageNo:t,salt:(new Date).getTime()});if(a.attr("src",l),r.on("click",(async function(){let e=$(this).data("page");try{await E({pageno:e})}catch(e){y.error({response:e})}})),n){const e=$(s.menu.con),n=$(s.menu.icon);n.attr("btn-role","menu"),e.append(n),r.append(e),e.on("click",(function(n){const s=n.target.getAttribute("btn-role");switch(n.preventDefault(),n.stopPropagation(),s){case"menu":$(".thumbMenuDiv").remove();const n=q,s=$(n.overlay);e.append(s);const r=$(n.base),a=$(n.con);r.append(a);const l=$(n.item);if(l.html("페이지 추가"),l.attr("btn-role","add"),a.append(l),v.pageLength>1){const e=$(n.item);e.html("페이지 삭제"),e.attr("btn-role","del"),a.append(e)}e.append(r),s.on("click",(function(){s.remove(),r.remove()}));break;case"add":K(t+1);break;case"del":!async function(e){const t=v.pageLength-1;y.startLoading(),function(e){const t=v.fileKey,i=v.bmPageList,n=[];for(const t of i)t<e?n.push(t):t>e&&n.push(t-1);v.bmPageList=n,o.setBookmark(t,n)}(e),await A.Delete.memoPage({meetingKey:i,pageNo:e}),await o.deleteDataFromIndex(v.fileKey,"page",e),await o.shiftLeftIndex(v.fileKey,"page",e),v.pageLength=t,v.file=null,v.pageno==e?v.pageno=null:v.pageno>e&&(v.pageno=v.pageno-1);try{await E({file:"MEMO",pageno:Math.max(e-1,1)})}catch(e){y.error({response:e})}y.endLoading()}(t)}}))}return r}async function K(e){const t=v.pageLength+1;y.startLoading(),function(e){const t=v.fileKey,i=v.bmPageList,n=[];for(const t of i)t<e?n.push(t):t>=e&&n.push(t+1);v.bmPageList=n,o.setBookmark(t,n)}(e),await ii.memoPage({meetingKey:i,pageNo:e}),await o.shiftRightIndex(v.fileKey,"page",e),v.pageLength=t,v.file=null,v.pageno>=e&&(v.pageno=v.pageno+1);try{await E({file:"MEMO",pageno:e})}catch(e){y.error({response:e})}y.endLoading()}function I(){!function(){let e=$(".tool.tUndo"),t=$(".tool.tRedo");e.unbind("click"),t.unbind("click"),e.addClass("disabled"),t.addClass("disabled")}(),0!=p.length&&function(){let e=$(".tool.tUndo");e.removeClass("disabled"),e.on("click",(function(){n.runExclusive((async()=>{await new Promise((async(e,t)=>{const i=v.pageno,n=p.pop();if(n||e(),i!=n.page)try{await E({pageno:n.page})}catch(e){t(e)}g.push(n),await o.deleteLast(v.fileKey),a.undo(),I(),e()}))}))}))}(),0!=g.length&&function(){let e=$(".tool.tRedo");e.removeClass("disabled"),e.on("click",(function(){n.runExclusive((async()=>{await new Promise((async(e,t)=>{const i=v.pageno,n=g.pop();if(n||e(),i!=n.page)try{await E({pageno:n.page})}catch(e){t(e)}p.push(n),await o.insert(v.fileKey,n),a.redo(n),I(),e()}))}))}))}()}function F(){var e=$(".bodyDiv .docuLeftSection");$(".bodyDiv .docuLeftSection .thumbnailDiv"),$(".bodyDiv .docuLeftSection .bookmarkDiv"),m.is(":visible")||(e.slideDown(0),m.slideDown(0))}function H(){R(),$(".thumbnailDiv").on("scroll",(async function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this).prop("scrollHeight")-10){const e=v.fileKey,t=$(this).children().length+1;R(),"MEMO"==e?await O(t):await N(e,t),H()}}))}function R(){$(".thumbnailDiv").unbind("scroll")}function U(){$(".infoSection").animate({left:-1*$(".infoSection").width()},100),$(".openCloseBtn").removeClass("iClose"),$(".openCloseBtn").addClass("iOpen")}function z(e,t){let i=v.pageLength;return i-e+1-t>=0?e+t-1:i}function j(){return new Promise((function(e,t){null==v.file&&e();const n=a.getGraphicContext(),s=new Checksum("fnv32",0);s.updateStringly(n);const o=s.result.toString(16);f&&f!=o?a.isEmpty()?new Promise((async(e,t)=>{let n=v.fileKey,s=v.pageno,o=a.getSourceImg();var r=$("#tm"+s),l=$("#bm"+s);r.find("img").attr("src",o.src),null!=l&&l.find("img").attr("src",o.src);try{"MEMO"==n?await ni.memoPage({meetingKey:i,pageNo:s}):await ni.notePage({meetingKey:i,fileKey:n,pageNo:s}),e()}catch(e){t(e)}})).then((function(){e()})).catch((function(e){t(e)})):a.getPadImage().then((function(e){return function(e){return new Promise((async(t,n)=>{let s=v.fileKey,o=v.pageno;var r=$("#tm"+o),a=$("#bm"+o);r.find("img").attr("src",e),null!=a&&a.find("img").attr("src",e),e=e.replace(/^data:image\/(png|jpg|gif);base64,/,"");try{"MEMO"==s?await ni.memoPage({meetingKey:i,pageNo:o,image:e}):await ni.notePage({meetingKey:i,fileKey:s,pageNo:o,image:e}),t()}catch(e){n(e)}}))}(e)})).then((function(){e()})).catch((function(e){t(e)})):e()}))}function G(){$(".docuLeftSection").removeClass("disabled"),$(".fileSection").removeClass("disabled"),$(".docuPagingDiv").removeClass("disabled")}function X(){$(".docuLeftSection").addClass("disabled"),$(".fileSection").addClass("disabled"),$(".docuPagingDiv").addClass("disabled")}return function(){$("#pageContainer");var e=$(".bodyDiv .docuLeftSection"),t=$(".bodyDiv .docuLeftSection .thumbnailDiv"),i=$(".bodyDiv .docuLeftSection .bookmarkDiv");function n(){return $(".infoSection").offset().left<0}e.slideUp(0),t.slideUp(0),i.slideUp(0),$(".btnThumbnail").click((function(s){$(this).hasClass("disabled")||(U(),s.stopPropagation(),n()&&t.is(":visible")?(e.slideUp(0),t.slideUp(0)):(e.slideDown(0),t.slideDown(0),i.slideUp(0),m=t,c=v.allPageList,x()))})),$(".btnBookmark").click((function(s){$(this).hasClass("disabled")||(U(),s.stopPropagation(),n()&&i.is(":visible")?(e.slideUp(0),i.slideUp(0)):(e.slideDown(0),t.slideUp(0),i.slideDown(0),m=i,c=v.bmPageList,L()))})),$(".openCloseBtn").on("click",(function(){$(".infoSection").offset().left<0?($(".infoSection").animate({left:0},100),$(".openCloseBtn").removeClass("iOpen"),$(".openCloseBtn").addClass("iClose")):U()}))}(),l=new Toastr({theme:"moon"}),$(".tool.tBookmark").on("click",(function(){!function(){let e=v.pageno;v.bmPageList.includes(e)?function(e){let t=v.fileKey,i=v.bmPageList;i=i.filter((function(t){return t!=e})),$("#tm"+e).removeClass("bookmark"),$("#bm"+e).remove(),v.bmPageList=i,o.setBookmark(t,i)}(e):function(e){let t=v.fileKey,i=v.bmPageList;i.push(e),i.sort((function(e,t){return e-t})),$("#tm"+e).addClass("bookmark");let n=$(".list.bookmarkDiv");n.html("");for(let s=0;s<i.length;s++){let o="MEMO"==t?B({pageno:i[s],includeOption:!1}):P(t,i[s]);e==i[s]&&o.addClass("selected"),o.addClass("bookmark"),o.attr("id","bm"+i[s]),n.append(o)}v.bmPageList=i,o.setBookmark(t,i)}(e)}()})),function(){a=new Ht({section:"padSection",width:0,height:0});const e=$("#toolCon");a.getToolInterface().forEach((t=>e.append(t))),a.on("transformScale",(function(e){clearTimeout(u),u=setTimeout((function(){l.show(Math.round(100*e)+" %")}),200)})),a.on("pointerMove",(function(e,t){})),a.on("laserStart",(function(e){r.trigger("laserStart",e)})),a.on("laserMove",(function(e){r.trigger("laserMove",e)})),a.on("laserEnd",(function(){r.trigger("laserEnd")})),b(),a.start()}(),r=si.fn=si.prototype={__proto__:h,clear:function(){v.file=null,v.fileKey=0,v.pageno=0,$(".list.thumbnailDiv").empty(),$(".list.bookmarkDiv").empty(),$(".thumbnailBtnDiv div").addClass("disabled"),L(),a.clear()},setNormalMode:function(){w(),a.stop(),a.update({options:{selectable:!0,disableTool:[],hideTool:["highlight"]}}),a.start(),a.selectTool("pointer"),b(),$(".recoveryToolCon").removeClass("disabled"),G(),$("#fileMngBtn").removeClass("disabled"),$("#memoBtn").removeClass("disabled")},setControlerMode:function(){console.log("setControlerMode"),w(),a.stop(),a.update({options:{selectable:!1,disableTool:["polyline","path","line","rectangle","textarea","eraser"],hideTool:[]}}),a.start(),a.selectTool("laser"),$(".recoveryToolCon").addClass("disabled"),G(),$("#fileMngBtn").addClass("disabled"),$("#memoBtn").addClass("disabled")},setPassiveMode:function(){w(),a.stop(),a.update({options:{selectable:!1,disableTool:["polyline","path","line","rectangle","textarea","eraser"],hideTool:["highlight"]}}),a.start(),a.selectTool("pointer"),$(".recoveryToolCon").addClass("disabled"),X(),$("#fileMngBtn").addClass("disabled"),$("#memoBtn").addClass("disabled")},setHoldMode:function(){w(),a.stop(),a.update({options:{selectable:!0,disableTool:[],hideTool:["highlight"]}}),a.start(),a.selectTool("pointer"),b(),$(".recoveryToolCon").removeClass("disabled"),X(),$("#fileMngBtn").addClass("disabled"),$("#memoBtn").removeClass("disabled")},showWaterMark:function(e){$(".controlWaterMark").remove();const t=$('<div class="controlWaterMark untouchable"></div>'),i=$("<span></span>");i.text(e),t.append(i),$("#docuSection").append(t)},deleteWaterMark:function(){$(".controlWaterMark").remove()},laser:function(e){switch(e.type){case"laserStart":a.laserStart(e.pos);break;case"laserMove":a.laserMove(e.pos);break;case"laserEnd":a.laserEnd()}},getPageData:function(){return v},selectFile:async function(e={}){return new Promise((async(t,i)=>{n.runExclusive((async()=>{try{await E(e),t()}catch(e){i(e)}}))}))},savePage:function(){return j()}}},oi=e=>P(`/api/ewp/dept/${e}/sub`),ri={deptOne:e=>P(`/api/ewp/dept/${e}`),subDeptList:oi,userList:(e={})=>{const{officeCode:t,deptId:i,deptName:n,userKey:s,userName:o}=e;return P("/api/ewp/user/list",{officeCode:t,deptId:i,deptName:n,userName:o})},subDeptList:oi,userAuthorityForMeeting:e=>P(`/api/ewp/user/authority/meeting/${e}`),adminAuthorityForMeeting:e=>P(`/api/ewp/admin/authority/meeting/${e}`),approvalManagerPublicList:(e={})=>{const{officeCode:t,roomType:i}=e;return P("/api/ewp/public/roster/approval-manager/list",{officeCode:t,roomType:i})}},ai="50001253",li=[{__proto__:h,name:"tree",title:"조직도",id:"user_tree",parentCode:ai,nowLevel:-1,generateNav(){const e=a("li");return this.$nav=e,e.id=this.id+"-tab",e.innerHTML=this.title,e},generateTab(){const e=a("div","partSelectDiv","flex-column");this.$tab=e,e.id=this.id;const t=[{name:"사업부",text:"사업부선택"},{name:"부서",text:"부서선택"},{name:"팀",text:"팀선택"}],i=(e,t)=>{const i=a("option");return i.value=e,i.innerHTML=t,i},n=e=>{const n=t[e],s=n.node;s.innerHTML="",s.disabled=!0;const o=i(0,n.text);o.style.display="none",s.appendChild(o)},s=e=>{n(this.nowLevel);const s=t[this.nowLevel].node;0!=e.length&&(e.forEach((e=>{const{deptId:t,deptName:n}=e,o=i(t,n);s.appendChild(o)})),s.disabled=!1)},o=async()=>{const e=this.parentCode;this.nowLevel+=1;const t=await ri.subDeptList(e);s(t)};return t.forEach(((t,i)=>{const s=a("div","d-flex","flex-row"),r=a("select");t.node=r,s.appendChild(r),e.appendChild(s),r.onchange=async()=>{const e=r.value;if(this.nowLevel>i)for(let e=i+1;e<=this.nowLevel;e++)n(e);this.nowLevel=i,this.parentCode=e,2!=this.nowLevel&&await o(),this.trigger("search",{deptId:e})},n(i)})),o(),this.clear=()=>{t.forEach(((e,t)=>{n(t)})),this.parentCode=ai,this.nowLevel=-1,o()},this.setDeptList=e=>{s(e)},e},open(){l(this.$nav,"active"),l(this.$tab,"d-flex"),c(this.$tab,"d-none")},close(){c(this.$nav,"active"),c(this.$tab,"d-flex"),l(this.$tab,"d-none")}},{__proto__:h,name:"text",title:"직원검색",id:"user_search",generateNav(){const e=a("li");return this.$nav=e,e.id=this.id+"-tab",e.innerHTML=this.title,e},generateTab(){const e=a("div","singleSrchDiv","d-flex");this.$tab=e,e.id=this.id;const t=a("div","inputBox");e.appendChild(t);const i=a("input");t.appendChild(i),i.type="text",i.setAttribute("placeholder","이름을 입력해주세요"),i.maxLength=10,i.oninput=()=>{((e,t={})=>{e.value.length>=e.maxLength&&(t.returnValue=!1),e.value=e.value.replace(/[ \{\}\[\]\/?.,;:|\)*~`!^\-_+┼<>@\#$%&\'\"\\\(\=]/gi,"")})(i)},i.onkeyup=e=>{13==e.keyCode&&this.search()};const n=a("div","srchBtn");e.appendChild(n);const s=a("i","far","fa-search");return s.onclick=()=>{this.search()},n.appendChild(s),this.clear=()=>{i.value=""},this.search=()=>{const e=i.value;e&&""!=e&&this.trigger("search",{searchText:e,nameplate:!0})},e},open(){l(this.$nav,"active"),l(this.$tab,"d-flex"),c(this.$tab,"d-none")},close(){c(this.$nav,"active"),c(this.$tab,"d-flex"),l(this.$tab,"d-none")}}],ci={getUserBook(){return this.userBook||(this.userBook={}),this.userBook},addUser(e){this.getUserBook()[e.userKey]=e},addUserList(e){const t=this.getUserBook();e.forEach((e=>{t[e.userKey]=e}))},deleteUserList(e){const t=this.getUserBook();e.forEach((e=>{delete t[e]}))},getUserByKey(e){return this.getUserBook()[e]}},di={init(e={}){const{officeCode:t,enableTab:i=["tree","text"],selectType:n="checkbox",checked:s=[],disabled:o=[]}=e;this.enableTab=i,this.officeCode=t,this.selectedList=[],this.checked=s,this.disabled=o,this.selectType=n,this.$modal?this.reset():this.generate()},reset(){this.clearTab(),this.clearUserSearchResultList(),this.clearAttendList()},generate(){this.$modal=a("div","modal"),this.$modal.id="addUserModal",this.$modal.style.display="none";const e=a("div","modalWrap"),t=a("div","modal_content"),i=a("div","modalBody","flex-direction-column");this.$modal.appendChild(e),e.appendChild(t),t.appendChild(i),(()=>{const e=a("ul","addUserTabDiv");i.appendChild(e);const t=a("div","px-3","pt-3","d-flex","flex-column");i.appendChild(t),this.selectTab=e=>{const t=li[e];li.forEach((e=>{e.isEnable&&e.close()})),this.clearTab(),this.clearUserSearchResultList(),t.open()},li.forEach(((i,n)=>{if(this.enableTab.includes(i.name)){i.isEnable=!0;const s=i.generateNav();e.appendChild(s),i.nav=s;const o=i.generateTab();t.appendChild(o),s.onclick=()=>{this.selectTab(n)}}else i.isEnable=!1})),this.clearTab=()=>{li.forEach(((e,t)=>{e.isEnable&&e.clear()}))}})(),(()=>{const e=a("div","px-3","pt-1","d-flex","flex-column");i.appendChild(e);const t=a("div","d-flex","flex-column","overflow-hidden","border","rounded","border-third","p-1");t.style.minHeight="10rem",t.style.maxHeight="20rem",e.appendChild(t);const n=a("div","d-flex","flex-row","border-bottom","pb-1"),s=a("div","pt-1","overflow-auto");(()=>{t.appendChild(n);const e=a("input");e.id="allChk",e.type="checkbox",e.style.visibility="hidden";const i=a("label","ml-2","my-auto");i.htmlFor="allChk",i.style.visibility="hidden",i.innerHTML="전체",n.appendChild(e),n.appendChild(i);const s=a("div","ml-auto","my-auto");n.appendChild(s);const o=a("span");s.appendChild(o);const r=a("span","mx-1");r.innerHTML="/",s.appendChild(r);const l=a("span");s.appendChild(l),e.onchange=()=>{const t=e.checked;this.getSearchResultList().forEach((e=>{const i=e.querySelector("input");if(0==i.disabled&&i.checked!=t){const e=new MouseEvent("click",{bubbles:!1,cancelable:!1});i.dispatchEvent(e)}}))},this.setAllUserCnt=()=>{const t=this.getSearchResultList().length;l.innerHTML=t,n.dataset.allCnt=t,0==t||"radio"==this.selectType?(e.style.visibility="hidden",i.style.visibility="hidden"):(e.style.visibility="visible",i.style.visibility="visible"),this.setSelectableUserCnt()},this.setSelectableUserCnt=()=>{const t=this.getSearchResultList().filter((e=>0==e.querySelector("input").disabled)).length;n.dataset.selectableCnt=t,n.dataset.disabledCnt=n.dataset.allCnt-t,0==t||"radio"==this.selectType?e.style.visibility="hidden":e.style.visibility="visible"},this.setSelectedUserCnt=()=>{const t=this.getSearchResultList().filter((e=>1==e.querySelector("input").checked)),i=t.length,s=t.filter((e=>0==e.querySelector("input").disabled)).length;o.innerHTML=i,n.dataset.selectedCnt=i,n.dataset.nowSelectedCnt=s,n.dataset.selectableCnt==s?(e.checked=!0,e.indeterminate=!1):0==s?(e.checked=!1,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}})(),(()=>{t.appendChild(s),this.getSearchResultList=()=>{const e=s.querySelectorAll("li");return Array.from(e)}})();const r=a("div","selectedUserDiv","border","rounded","border-third","overflow-auto","empty-hidden");r.style.maxHeight="10rem",e.appendChild(r);const c=e=>{const t=[];this.selectedList.forEach((i=>{if(e&&i.userKey!=e)t.push(i);else{const e=s.querySelector("#user"+i.userKey);e&&(e.checked=!1);const t=r.querySelector("#attend"+i.userKey);t&&t.remove()}})),this.selectedList=t,this.setSelectedUserCnt()};this.clearUserSearchResultList=()=>{s.innerHTML="",this.setAllUserCnt(),this.setSelectedUserCnt()},this.clearAttendList=()=>{this.selectedList=[],r.innerHTML=""};const d=(e,t)=>{const i=a("div","attend");i.id="attend"+e;const n=a("span");n.innerHTML=t,i.appendChild(n);const s=a("div","btn-del");s.setAttribute("title","삭제"),i.appendChild(s),s.onclick=()=>{c(e)},r.appendChild(i),this.setSelectedUserCnt()},h=(e,t,i)=>{const n=a("li","d-flex","my-2"),o=a("input");o.name="user",o.type=this.selectType,o.value=t,o.id="user"+t,n.appendChild(o);const r=a("label","ml-2","my-auto");r.innerHTML=i,r.htmlFor="user"+t,n.appendChild(r),s.appendChild(n),this.checked.includes(t)&&(o.checked=!0,"checkbox"==this.selectType&&(o.disabled=!0)),this.disabled.includes(t)&&(o.disabled=!0,l(n,"disabled")),this.selectedList.map((e=>e.userKey)).includes(t)&&(o.checked=!0),o.onchange=()=>{1!=o.disabled&&(1==o.checked?("radio"==this.selectType&&c(),this.selectedList.push({userKey:t,deptId:e,nameplate:i}),d(t,i)):c(t))}};li.forEach(((e,t)=>{e.on("search",(async e=>{const{deptId:t,searchText:i,nameplate:n=!1}=e,s=await ri.userList({officeCode:this.officeCode,deptId:t,userName:i});this.clearUserSearchResultList(),o(s)||(ci.addUserList(s),s.forEach((e=>{h(e.deptId,e.userKey,n?e.nameplate:e.userName)})),this.setAllUserCnt(),this.setSelectedUserCnt())}))}))})(),(()=>{const e=a("div","modalBtnDiv");t.appendChild(e);const i=a("div","btn","btn-md","btn-silver");i.innerHTML="취 소",this.getCancelBtn=()=>i,e.appendChild(i);const n=a("div","btn","btn-md","btn-blue");n.innerHTML="확 인",this.getConfirmBtn=()=>n,e.appendChild(n)})(),this.selectTab(0),d("body").appendChild(this.$modal)},destroy(){this.$modal.remove(),delete this.$modal,this.selectedList=[]},update(e={}){this.init(e)},show(){this.$modal||this.init(),this.$modal.style.display="block"},hide(){this.reset(),this.$modal.style.display="none"},getSelectedList(){return this.selectedList}},hi={__proto__:h,init(e={}){const{onchange:t}=e;return di.init(e),di.getConfirmBtn().onclick=()=>{const e=di.getSelectedList();di.hide(),e.length>0&&(this.trigger("change",e),t?.(e))},di.getCancelBtn().onclick=()=>{di.hide()},this},update(e={}){return this.init(e)},show(){di.show()},getUser:e=>ci.getUserByKey(e)},ui={Get:{nextScheduleOne:e=>P(`/api/ewp/meeting/schedule/${e}/next`,{skdKey:e})},Post:{},Put:{scheduleExtend:(e={})=>{const{skdKey:t,minutes:i}=e;return _(`/api/ewp/meeting/schedule/${t}/extend/minutes/${i}`,{queryParams:{skdKey:t,minutes:i}})},scheduleFinish:(e={})=>{const{skdKey:t}=e;return _(`/api/ewp/meeting/schedule/${t}/finish`)}},Delete:{}},pi={Get:{attendeeOne:(e={})=>{const{meetingKey:t,attendKey:i}=e;return P(`/api/ewp/meeting/${t}/attendee/${i}`)},attendeeListByMeeting:(e={})=>{const{meetingKey:t,attendRole:i,assistantYN:n,attendYN:s,exitYN:o,signYN:r}=e;return P(`/api/ewp/meeting/${t}/attendee/list`,{attendRole:i,assistantYN:n,attendYN:s,signYN:r})},attendeeSimpleListByMeeting:(e={})=>{const{meetingKey:t}=e;return P(`/api/ewp/meeting/${t}/attendee/list/simple`)},selectSecurityAgreementOne:(e={})=>{const{meetingKey:t,attendKey:i}=e;return P(`/api/ewp/meeting/${t}/attendee/${i}/security-agreement`)},selectSecurityAgreementAll:(e={})=>{const{meetingKey:t}=e;return P(`/api/ewp/meeting/${t}/attendee/security-agreement`)}},Post:{attendeeList:(e={})=>{const{meetingKey:t,list:i}=e;return O(`/api/ewp/meeting/${t}/attendee`,{data:i,headers:{"Content-Type":"application/json; charset=utf-8"}})},insertSecurityAgreementOne:(e={})=>{const{meetingKey:t,signSrc:i}=e;return O(`/api/ewp/meeting/${t}/attendee/security-agreement`,{data:i,headers:{"Content-Type":"application/json; charset=utf-8"}})}},Put:{assistant:(e={})=>{const{meetingKey:t,attendKey:i,assistantYN:n}=e;return _(`/api/ewp/meeting/${t}/attendee/${i}/assistant/${n}`)},check:(e={})=>{const{meetingKey:t,attendKey:i,attendYN:n}=e;return _(`/api/ewp/meeting/${t}/attendee/${i}/attendance/${n}`)},sign:(e={})=>{const{meetingKey:t,attendKey:i,signYN:n,signSrc:s}=e;return _(`/api/ewp/meeting/${t}/attendee/${i}/sign/${n}`,{data:s,headers:{"Content-Type":"application/json; charset=utf-8"}})}},Delete:{}},gi={Get:{assignOne:e=>P(`/api/ewp/meeting/assign/${e}`,{skdKey:e}),assignList:(e={})=>{const{officeCode:t,approvalStatus:i,roomType:n,roomKey:s,title:o,host:r,attendeeName:a,elecYN:l,secretYN:c,startDate:d,endDate:h,pageNo:u,pageCnt:p,orderColumn:g,orderDirection:f="ASC"}=e;return P("/api/ewp/meeting/assign/list",{officeCode:t,approvalStatus:i,roomType:n,roomKey:s,title:o,host:r,attendeeName:a,elecYN:l,secretYN:c,startDate:d,endDate:h,pageNo:u,pageCnt:p,orderColumn:g,orderDirection:f})},assignListCnt:(e={})=>{const{officeCode:t,approvalStatus:i,roomType:n,roomKey:s,title:o,host:r,attendeeName:a,elecYN:l,secretYN:c,startDate:d,endDate:h,pageNo:u,pageCnt:p}=e;return P("/api/ewp/meeting/assign/list/cnt",{officeCode:t,approvalStatus:i,roomType:n,roomKey:s,title:o,host:r,attendeeName:a,elecYN:l,secretYN:c,startDate:d,endDate:h,pageNo:u,pageCnt:p})},assignListForPlanned:(e={})=>{const{startDate:t,endDate:i}=e;return P("/api/ewp/meeting/assign/planned/list",{startDate:t,endDate:i})},assignStatForPlanned:(e={})=>{const{startDate:t,endDate:i}=e;return P("/api/ewp/meeting/assign/planned/stat",{startDate:t,endDate:i})},assignListForRegister:(e={})=>{const{pageNo:t,pageCnt:i}=e;return P("/api/ewp/meeting/assign/register/list",{pageNo:t,pageCnt:i})},assignListForDisplay:(e={})=>{const{officeCode:t,roomType:i,roomKey:n,startDate:s,endDate:o}=e;return P("/api/ewp/meeting/assign/display/list",{officeCode:t,roomType:i,roomKey:n,startDate:s,endDate:o})},assignPublicListForDisplay:(e={})=>{const{officeCode:t,roomType:i,roomKey:n,startDate:s,endDate:o}=e;return P("/api/ewp/public/meeting/assign/display/list",{officeCode:t,roomType:i,roomKey:n,startDate:s,endDate:o})},userArchiveList:(e={})=>{const{skdHost:t,title:i,originalName:n,roleType:s,startDate:o,endDate:r,pageNo:a,pageCnt:l}=e;return P("/api/ewp/meeting/archive/manage/user",{skdHost:t,title:i,originalName:n,roleType:s,startDate:o,endDate:r,pageNo:a,pageCnt:l})},deptArchiveList:(e={})=>{const{skdHost:t,title:i,originalName:n,startDate:s,endDate:o,pageNo:r,pageCnt:a}=e;return P("/api/ewp/meeting/archive/manage/dept",{skdHost:t,title:i,originalName:n,startDate:s,endDate:o,pageNo:r,pageCnt:a})},adminArchiveList:(e={})=>{const{skdHost:t,title:i,originalName:n,startDate:s,endDate:o,pageNo:r,pageCnt:a}=e;return P("/api/ewp/admin/master/meeting/archive/manage",{skdHost:t,title:i,originalName:n,startDate:s,endDate:o,pageNo:r,pageCnt:a})},userAssignList:(e={})=>{const{approvalStatus:t,meetingStatus:i,roomType:n,title:s,host:o,writerKey:r,attendeeName:a,elecYN:l,secretYN:c,startDate:d,endDate:h,pageNo:u,pageCnt:p,orderColumn:g,orderDirection:f="DESC"}=e;return P("/api/ewp/meeting/assign/manage/user",{approvalStatus:t,meetingStatus:i,roomType:n,title:s,host:o,writerKey:r,attendeeName:a,elecYN:l,secretYN:c,startDate:d,endDate:h,pageNo:u,pageCnt:p,orderColumn:g,orderDirection:f})},deptAssignList:(e={})=>{const{approvalStatus:t,meetingStatus:i,roomType:n,title:s,host:o,attendeeName:r,elecYN:a,secretYN:l,startDate:c,endDate:d,pageNo:h,pageCnt:u,orderColumn:p,orderDirection:g="DESC"}=e;return P("/api/ewp/meeting/assign/manage/dept",{approvalStatus:t,meetingStatus:i,roomType:n,title:s,host:o,attendeeName:r,elecYN:a,secretYN:l,startDate:c,endDate:d,pageNo:h,pageCnt:u,orderColumn:p,orderDirection:g})}},Post:{assignApproval:(e={})=>{const{skdKey:t,status:i,comment:n}=e;return O(`/api/ewp/meeting/assign/${t}/approval/${i}`,{queryParams:{comment:n}})},assignOne:(e={})=>{const{roomType:t,formData:i}=e;return O("/api/ewp/meeting/assign/post",{data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}},Put:{assignOne:(e={})=>{const{skdKey:t,formData:i}=e;return _(`/api/ewp/meeting/assign/${t}`,{data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}},Delete:{}};let fi,mi;const yi=new s,vi={streamer:0,streamerSessionId:null,entrySet:[]};let bi,wi,Ci,ki,Ei=[],Ti={},Si=[],xi=[];const Li=async e=>{await mi.savePage(),Yi.unsetExitListener(),location.href=e},Di=async e=>{Yi.unsetExitListener(),location.href=e},Ni={init(e={}){const{loginKey:t,roomType:i,reqKey:n,skdKey:s,meetingKey:o,assign:r}=e;this.loginKey=t,this.assign=r,this.roomType=i,this.reqKey=n,this.skdKey=s,this.meetingKey=o},set(e={}){const{attendRole:t=this.attendRole}=e;this.attendRole=t},getFileService:()=>H,getSocketService:()=>U},Mi={setBeginTimer(){$(".btnFinish").click((function(){authorities.includes("FUNC_CANCEL")?Ui("hostCancel_hostModal"):Ui("guestFinish_guestModal")})),fi=TimerMng({intervalEndTime:Ni.assign.beginDateTime,intervalEndCall:async()=>{authorities=await ri.userAuthorityForMeeting(meetingKey),$i(),this.setFinishTimer()},timerFormat:"ss"})},setFinishTimer(){$(".btnFinish").removeClass("disabled"),$(".btnFinish").click((function(){authorities.includes("FUNC_FINISH")?Ui("hostFinish_hostModal"):Ui("guestFinish_guestModal")})),fi.update({fixedEndTime:Ni.assign.finishDateTime,intervalEndTime:Ni.assign.expDateTime,fixedCall:function(e){if($(".finishCount").text(" -"+e+"분"),zi()&&(5==e||10==e)){const t=y.get("timeCountModal"),i=t.querySelector("[data-timer=end]");i&&(i.innerHTML=e),t.show()}},fixedEndCall:async()=>{$(".finishCount").text(""),await mi.savePage(),zi()?Ui("timeout_hostModal"):Ui("timeoutHost_guestModal")},intervalCall:function(e,t){y.getPopupList().forEach((e=>{const i=e.querySelector("[data-timer=exit]");i&&(i.innerHTML=t)}))},intervalEndCall:function(){Yi.unsetExitListener(),Di("/ewp/home")},timerFormat:"ss"})},extSchedule(){const e=y.get("timeExtensionModal");w({request:ui.Get.nextScheduleOne,param:skdKey,loading:!1}).success((async t=>{const i=e.querySelector(".intervalInfo");i.innerHTML="";const n=e.querySelector(".extInfo");n.innerHTML="";const s=(e={})=>{const{label:t,time:i,host:n}=e,s=a("div"),o=a("span","label");o.innerHTML=t,s.appendChild(o);const r=a("span","time");r.innerHTML=i,s.appendChild(r);const l=a("span","name");return l.innerHTML=n,s.appendChild(l),s},o=moment(Ni.assign.finishDateTime),r=s({label:"현재 회의 종료",time:o.format("HH:mm"),host:Ni.assign.skdHost});l(r,"prev"),i.appendChild(r);let c=moment(CLOSE_TIME,"HH:mm").clone();if(t){c=moment(t.beginDateTime);const e=s({label:"다음 회의 시작",time:c.format("HH:mm"),host:t.skdHost});l(e,"next"),i.appendChild(e)}let d=c.diff(o),h=moment.duration(d).asMinutes();if(h<INTERVAL_MINUTE){const t=a("span");t.innerHTML="회의시간을 더 이상 연장할 수 없습니다.",n.appendChild(t),e.disableBtn("OK"),e.show()}else{const t=a("span");t.innerHTML="희망 연장시간",n.appendChild(t);const i=a("span","mx-2");i.innerHTML=":",n.appendChild(i);const s=a("select");n.appendChild(s);for(let e=1;e<=h/INTERVAL_MINUTE;e++){const t=a("option");t.value=e*INTERVAL_MINUTE,t.innerText=e*INTERVAL_MINUTE+"분",s.appendChild(t)}if(e.enableBtn("OK"),"OK"==await e.show()){const e=s.value;w({request:ui.Put.scheduleExtend,param:{skdKey:Ni.skdKey,minutes:e}}).success((e=>{U.sendUpdateMsg({resourceType:"SCHEDULE",data:Ni.assign.skdKey})})).exe()}}})).exe()}};function Pi(e){e&&(Ei=e),function(e){Ci=e.length,bi=void 0,wi=null,Si=[],xi=[],Ti={},Ei.forEach((e=>Ti[e.attendKey]=e));for(let t=0;t<e.length;t++){let i=e[t];if("HOST"==i.attendRole?bi=i:"Y"==i.assistantYN?wi=i:"ATTENDEE"==i.attendRole?Si.push(i):"OBSERVER"==i.attendRole&&xi.push(i),i.userKey==loginKey){const e="Y"==i.assistantYN?"ASSISTANT":i.attendRole;Ni.set({attendRole:e})}}}(Ei),function(){let e=$("#userList");e.empty(),e.append(Oi(bi,"HOST")),wi?e.append(Oi(wi,"ASSISTANT")):authorities.includes("FUNC_UPDATE")&&e.append(function(){let e=z,t=$(e.infoCon),i=$(e.infoBody.name),n=$(e.assistantBody.nameInput);return t.addClass("u2"),authorities.includes("FUNC_UPDATE")&&n.on("click",(function(){let e=[];e=e.concat(Si),e=e.concat(xi),0==e.length?y.info({msg:"보조 진행자로 지정 가능한 참석자가 없습니다."}):showSelectAssistantModal(e,(function(e){_i(e)}))})),i.html(n),t.append(i),t}());for(let t=0;t<Si.length;t++){let i=Si[t];e.append(Oi(i,"ATTENDEE"))}for(let t=0;t<xi.length;t++){let i=xi[t];e.append(Oi(i,"OBSERVER"))}}(),function(){let e=$(".userListDiv");ki=e.find(".a1").length,$("#totalCount").text(Ci),$("#attendCount").text(ki)}()}async function $i(){$("#manageBtn");const e=d("#inviteBtn");e&&(e.onclick=null,e.style.display="none");const t=d("#extBtn");t&&(t.onclick=null,t.style.display="none");const i=d("#reportBtn");i&&(i.onclick=null,i.style.display="none");const n=d("#cameraBtn");n&&(n.onclick=null,n.style.display="none");const s=d("#voiceBtn");if(s&&(s.onclick=null,s.style.display="none"),authorities.includes("FUNC_INVITE")&&(e.style.display="inline-flex",e.onclick=Bi),authorities.includes("FUNC_EXTEND")&&(t.style.display="",t.onclick=()=>{Mi.extSchedule()}),H.disableUpload(),authorities.includes("FUNC_UPLOAD")&&"SSO"==loginType&&H.enableUpload(),authorities.includes("FUNC_UPDATE"),authorities.includes("FUNC_PHOTO")){n.style.display="inline-flex";const e=new MouseEvent("click",{bubbles:!1,cancelable:!1});n.onclick=()=>{const t=a("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.capture="camera",t.style.display="none",t.onchange=async e=>{const i=Object.values(t.files),n=new FormData;n.append("list",i[0]),y.startLoading({text:"사진을 업로드 중입니다...",animation:"foldingCube"});const s=await A.Post.meetingFileList({meetingKey,fileType:"PHOTO",fileList:n});y.endLoading(),200==s.status?toastr.info("사진을 업로드했습니다."):toastr.error("사진을 업로드할 수 없습니다. 다시 시도해 주세요.")},t.dispatchEvent(e)}}if(authorities.includes("FUNC_VOICE")){let e=!1,t=null;const i=[];s.style.display="inline-flex",s.onclick=async()=>{if(e){if("OK"!=await y.confirm({msg:"녹음을 중단합니다."}))return;t.stop(),e=!1,c(s,"recording")}else{if("OK"!=await y.confirm({msg:"녹음을 시작합니다."}))return;const n=await navigator.mediaDevices.getUserMedia({audio:!0});t=new MediaRecorder(n),t.ondataavailable=e=>{i.push(e.data)},t.onstop=async e=>{y.startLoading({text:"녹음을 업로드 중입니다...",animation:"foldingCube"});const t=new Blob(i,{type:"audio/ogg codecs=opus"});i.splice(0);const n=new FormData;n.append("list",t);let s=!1;try{200==(await A.Post.meetingFileList({meetingKey,fileType:"VOICE",fileList:n})).status&&(s=!0)}catch(e){}y.endLoading(),1==s?toastr.info("녹음을 업로드했습니다."):toastr.error("녹음을 업로드할 수 없습니다. 다시 시도해 주세요.")},t.start(),e=!0,l(s,"recording")}}}authorities.includes("FUNC_REPORT")&&(i.style.display="",i.onclick=()=>{Li("/ewp/meeting/"+meetingKey+"/report")})}function Oi(e,t){let i=z,n=$(i.infoCon);if(e){switch(t){case"HOST":n.addClass("u1");break;case"ASSISTANT":n.addClass("u2");break;case"ATTENDEE":n.addClass("u3");break;case"OBSERVER":n.addClass("u4");break;case"GUEST":n.addClass("u5")}let s=$(i.infoBody.infoBtn);n.append(s),s.on("click",(function(){const t=y.get("userInfoModal"),i=t.querySelector("#userPic");i.innerHTML="";const n=a("img","img-profile","my-4");n.src="/api/ewp/user/"+e.user.userKey+"/img",n.onload=()=>{c(i,"userPic"),i.appendChild(n)},pi.Get.attendeeOne(e).then((e=>{const i=e.user;t.querySelector(".uDivision").innerHTML=i.deptName,t.querySelector(".uNameGrade").innerHTML=i.nameplate,t.querySelector(".uComNum").innerHTML=i.userId,t.querySelector(".uPhonNum").innerHTML=i.personalCellPhone,t.querySelector(".uEmail").innerHTML=i.email,t.show()})).catch((e=>{qi(e)}))}));let o=$(i.infoBody.name);o.html(e.user.nameplate),vi.entrySet.includes(e.user.userKey)&&o.addClass("blue"),"ASSISTANT"==t&&authorities.includes("FUNC_UPDATE")&&(o.on("click",(function(){let e=[];e=e.concat(Si),e=e.concat(xi),0!=e.length||wi?showSelectAssistantModal(e,(function(e){_i(e)})):y.info({msg:"보조 진행자로 지정 가능한 참석자가 없습니다."})})),o.css("cursor","pointer")),n.append(o);let r=$(i.infoBody.attendBtn);"Y"==e.attendYN&&(n.addClass("a1"),r.addClass("switchOn")),authorities.includes("FUNC_CHECK")&&(r.on("click",(function(){let t=$(this).hasClass("switchOn")?"N":"Y";pi.Put.check({meetingKey,attendKey:e.attendKey,attendYN:t}).then((function(e){if(200!=e.status)throw e})).catch((function(e){qi(e)}))})),n.append(r))}return n}function _i(e){let t,i;null==e?(t=wi.attendKey,i="N"):(t=e.attendKey,i="Y"),pi.Put.assistant({meetingKey,attendKey:t,assistantYN:i}).then((function(e){if(200!=e.status)throw e})).catch((function(e){qi(e)}))}async function Bi(){(()=>{const e=Ei.map((e=>e.userKey));hi.init({officeCode}),hi.update({checked:[],disabled:e}),hi.unbind("change"),hi.on("change",(async e=>{const t=[];e.forEach((e=>{const i={userKey:e.userKey,deptId:e.deptId,data:"ATTENDEE",operation:"CREATE"};t.push(i)})),await(async e=>{if(0!=e.length)try{const t=await pi.Post.attendeeList({meetingKey,list:e});if(200!=t.status)throw t}catch(e){console.error(e),y.error({response:e})}})(t)})),hi.show()})()}let Ki="end",Ii="end",Ai=null;async function Fi(e={}){const{streamer:t,streamerSessionId:i,fileKey:n,pageno:s}=e,o=vi.streamer;if(!t)return await Hi("end"),void(Ai=null);vi.streamer=t,vi.streamerSessionId=i,vi.fileKey=n,vi.pageno=s,t!=o&&(i==sessionId?Hi("control"):"disconnect"!=Ki&&Hi("connect")),Ri()}async function Hi(e){const{streamer:t=null,fileKey:i=null,pageno:n=null}=vi;y.close("confirmRestorePage");const s=document.querySelector("div.btnControl"),o=s.querySelector("span");switch(e){case"control":{const e=Ei.find((e=>e.user.userKey==t));Ki="control",s.classList.remove("c0","c1","c2","c3"),s.classList.add("c1"),o.innerHTML=e.user.userName,mi.deleteWaterMark(),mi.setControlerMode()}break;case"end":Ki="end",delete vi?.streamer,delete vi?.fileKey,delete vi?.pageno,o.innerHTML="",s.classList.remove("c0","c1","c2","c3"),s.classList.add("c0"),mi.deleteWaterMark(),mi.setNormalMode(),Ai&&await async function(){const{file:e,pageno:t}=mi.getPageData();e==Ai.file&&t==Ai.pageno||(y.close("confirmRestorePage"),"OK"==await y.confirm({title:"화면 공유",msg:"화면 공유 이전의 본인 화면으로 이동하시겠습니까?",id:"confirmRestorePage"})&&await mi.selectFile({file:Ai.file,pageno:Ai.pageno}),Ai=null)}();break;case"connect":{const e=Ei.find((e=>e.user.userKey==t));if(e){const t="disconnect"==Ki?"화면 공유를 복귀합니다":"화면 공유를 시작합니다";Ki="connect",s.classList.remove("c0","c1","c2","c3"),s.classList.add("c2"),o.innerHTML=e.user.userName,mi.showWaterMark(e.user.userId),mi.setPassiveMode(),toastr.error(t,e.user.userName)}if("end"==Ii){const{file:e,pageno:t}=mi.getPageData();e&&paeno&&(Ai={file:e,pageno:t}),Ai=mi.getPageData()}}break;case"disconnect":Ki="disconnect",s.classList.remove("c0","c1","c2","c3"),s.classList.add("c3"),o.innerHTML="잠시중단",mi.deleteWaterMark(),mi.setHoldMode()}Ii=Ki}async function Ri(){const{streamer:e=null,fileKey:t=null,pageno:i=null}=vi;if("disconnect"==Ki)return;const n=H.getFile(t);await mi.selectFile({file:n,pageno:i})}async function Ui(e){y.closeAll(),y.endLoading();try{switch(await y.show(e)){case"CLOSE":break;case"EXIT":try{Li("/ewp/home")}catch(e){qi(e)}break;case"CANCEL":"OK"==await y.confirm({msg:"회의를 취소하시겠습니까?"})&&w({request:gi.Post.approval,param:{skdKey,status:3,comment:"신청자 취소"},exception:"success-only"}).success((e=>{y.startLoading(),setTimeout((()=>{U.sendUpdateMsg({resourceType:"SCHEDULE",data:Ni.assign.skdKey}),Di("/ewp/home")}),3e3)})).error((e=>{y.error({response:e})})).finally((()=>{})).exe();break;case"FINISH":try{const e=await ui.Put.scheduleFinish({skdKey:Ni.assign.skdKey});if(200!=e.status)throw e;U.sendUpdateMsg({resourceType:"SCHEDULE",data:Ni.assign.skdKey}),Li("/ewp/home")}catch(e){qi(e)}}}catch(e){console.log("err",e)}}function zi(){return loginKey==bi?.userKey||loginKey==wi?.userKey}const Yi={init(){this.beforeUnloadListener=e=>{e.returnValue=""},this.setExitListener(),this.setExitBtn(),this.setScreenResizeBtn(),this.setControlBtn(),this.setMemoBtn(),this.securityInfoBtn()},setExitListener(){addEventListener("beforeunload",this.beforeUnloadListener,{capture:!0})},unsetExitListener(){removeEventListener("beforeunload",this.beforeUnloadListener,{capture:!0})},setExitBtn(){const e=d("#logoBtn");e&&(e.onclick=()=>{y.confirm({msg:"회의스케줄 화면으로 이동합니다. <br>회의스케줄 화면에서 해당 회의를 클릭하시면 재입장이 가능합니다."}).then((async e=>{"OK"==e&&Li("/ewp/home")}))});const t=d("#archiveBtn");t&&(t.onclick=()=>{y.confirm({msg:"내 파일함으로 이동합니다. <br>회의실 재입장은 내파일함 화면 타이틀 옆의 뒤로가기 버튼 또는 회의 스케줄 화면에서 가능합니다."}).then((async e=>{"OK"==e&&Li("/ewp/meeting/archive/manage/user")}))})},setScreenResizeBtn(){const e=d(".btnExpand"),t=d(".btnContract");if(e&&t){[e,t].forEach((e=>{e.show=()=>{e.style.display=""},e.hide=()=>{e.style.display="none"}}));const i=()=>{document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||(t.hide(),e.show())};document.addEventListener("fullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("MSFullscreenChange",i);const n=document.documentElement;e.onclick=()=>{n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen&&n.msRequestFullscreen(),e.hide(),t.show()},t.onclick=()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),t.hide(),e.show()}}},setControlBtn(){const e=d(".btnControl");e&&(e.onclick=()=>{!function(){const{streamer:e=null,fileKey:t=null,pageno:i=null}=vi,n=mi.getPageData();if("end"==Ki)y.confirm({title:" 화면 공유",msg:"화면공유를 시작합니다."}).then((function(e){if("OK"==e){const e=mi.getPageData();if("MEMO"==e.file)return void y.info({title:" 화면 공유",msg:"메모장은 화면공유를 지원하지 않습니다."});if(!e.file)return void y.info({title:" 화면 공유",msg:"화면공유를 위한 첨부파일을 선택해 주세요."});U.sendNoticeMsg({actionType:"CONTROL",data:{fileKey:e.fileKey,pageno:e.pageno}})}}));else if("control"==Ki)y.confirm({msg:"내 화면공유를 종료합니다."}).then((e=>{"OK"==e&&U.sendNoticeMsg({actionType:"CONTROL"})}));else{let e=[];"connect"==Ki?e.push({text:"화면공유 잠시중단",isPrimary:!1,key:"disconnect"}):"disconnect"==Ki&&e.push({text:"화면공유 계속",isPrimary:!1,key:"connect"}),e.push({text:"내 화면공유를 시작합니다.",isPrimary:!0,key:"control"}),y.select({title:"화면 공유",select:e}).then((e=>{switch(e){case"connect":Hi("connect"),Ri();break;case"disconnect":Hi("disconnect");break;case"control":U.sendNoticeMsg({actionType:"CONTROL",data:{fileKey:n.fileKey,pageno:n.pageno}})}}))}}()})},setMemoBtn(){const e=d("#memoBtn");e&&(e.onclick=async()=>{await mi.selectFile({file:"MEMO",pageno:1})})},securityInfoBtn(){const e=d("#securityInfoBtn");e&&(e.onclick=()=>{y.show("securityInfoModal")})}};function qi(e){console.log("err",e),y.error({response:e})}const ji={setDom(){this.setSecretLevel(),this.setRoomInfo(),this.setSchedule(),this.setTitle()},setSecretLevel(){const e=Ni.assign.secretYN,t=d("#levelBadge");l(t,"Y"==e?"secuY":"secuN");const i=d("#securityInfoBtn");"N"==e&&i.remove()},setRoomInfo(){const e=Ni.assign.room;d("#roomName").innerHTML=e.roomName},setSchedule(){const e=Ni.assign;d("#scheduleTime").innerHTML=moment(e.beginDateTime).format("HH:mm")+" ~ "+moment(e.finishDateTime).format("HH:mm")},setTitle(){const e=Ni.assign;d("#title").innerHTML=e.title}};(async()=>{y.startLoading({text:"전자회의를 준비중입니다..."});const e=await gi.Get.assignOne(skdKey);Ni.init({loginKey,roomType:e.roomType,reqKey:e.reqKey,skdKey,meetingKey,assign:e}),ji.setDom();try{Mi.setBeginTimer(),Pi(await pi.Get.attendeeListByMeeting({meetingKey})),$i(),await H.init({instanceProvider:Ni}),function(e){mi=si(e),mi.on("selectFile",(function(e,t){$("div.btnControl"),"control"==Ki&&U.sendNoticeMsg({actionType:"CONTROL",data:{fileKey:e,pageno:t}})})),mi.on("laserStart",(function(e){"control"==Ki&&U.sendNoticeMsg({actionType:"HIGHLIGHT",data:{type:"laserStart",pos:e}})})),mi.on("laserMove",(function(e){"control"==Ki&&U.sendNoticeMsg({actionType:"HIGHLIGHT",data:{type:"laserMove",pos:e}})})),mi.on("laserEnd",(function(){"control"==Ki&&U.sendNoticeMsg({actionType:"HIGHLIGHT",data:{type:"laserEnd"}})})),H.on("select",(async(e={})=>{try{await mi.selectFile(e)}catch(e){qi(e)}}))}(Ni),Yi.init(),await(async()=>new Promise(((e,t)=>{U.init({debug:!0,instanceProvider:Ni,destinationURL:"/update/"+meetingKey}),U.connected((()=>{U.subscribe({url:"/room/"+meetingKey,receiver:async e=>{const t=JSON.parse(e.body);switch(t.messageType){case"UPDATE":yi.runExclusive((async()=>{await function(e){return new Promise((async(t,i)=>{e.sender;let n=e.data;switch(e.resourceType){case"ASSISTANT":n==loginKey&&(authorities=await ri.userAuthorityForMeeting(meetingKey),$i()),Pi();break;case"ATTENDEE":const e=async e=>{console.log("updateAttendee",e);let t=Ti[e.attendKey];if(t){const{attendRole:i=t.attendRole,assistantYN:n=t.assistantYN,attendYN:s=t.attendYN,exitYN:o=t.exitYN,signYN:r=t.signYN,signSrc:a=t.signSrc}=e;t.attendRole=i,t.assistantYN=n,t.attendYN=s,t.exitYN=o,t.signYN=r,t.signSrc=a}else t=e;Ti[t.attendKey]=t,e.assistantYN&&t.userKey==loginKey&&(authorities=await ri.userAuthorityForMeeting(meetingKey),$i())},t=[].concat(n);for(let i of t)await e(i);Pi(Object.values(Ti));break;case"SCHEDULE":if(3==n.skdStatus||4==n.skdStatus)Ui("hostCancel_guestModal");else if(Ni.assign.finishDateTime!=n.finishDateTime){let e=moment(Ni.assign.finishDateTime),t=moment(n.finishDateTime);e.isValid()&&moment.duration(e.diff(t)).asMilliseconds(),Ni.assign.beginDateTime=n.beginDateTime,Ni.assign.finishDateTime=n.finishDateTime,Ni.assign.expDateTime=n.expDateTime,Mi.setFinishTimer(),$(".finishCount").text(""),$(".mTime").text(moment(Ni.assign.beginDateTime).format("HH:mm")+" ~ "+moment(Ni.assign.finishDateTime).format("HH:mm"))}break;case"FILE":H.updateFile(n)}t()}))}(t)}));break;case"REQUEST":yi.runExclusive((async()=>{await function(e){e.sender,e.data,e.actionType}(t)}));break;case"NOTICE":await function(e){return new Promise((async(t,i)=>{e.sender;const n=e.data,s=n.streamer;switch(e.actionType){case"JOIN":case"LEAVE":vi.entrySet.length!=n.entrySet.length&&(vi.entrySet=n.entrySet,Pi()),vi.entrySet.includes(loginKey)||U.sendJoinMsg(),s&&await Fi(n);break;case"HIGHLIGHT":"connect"==Ki&&mi.laser(n);break;case"CONTROL":await Fi(n)}t()}))}(t);break;case"SYNC":yi.runExclusive((async()=>{await async function(e){return new Promise((async(t,i)=>{e.sender;let n=e.data;switch(e.resourceType){case"PROGRESS":break;case"FILE":const e=n.map((e=>e.fileKey)),t=H.getFileList().filter((t=>!e.includes(t.fileKey))).map((e=>e.fileKey)),i=mi.getPageData();t.includes(i.fileKey)&&mi.clear(),H.setFileList(n);break;case"ATTENDEE":for(let e of n)Ti[e.attendKey]=e,("Y"==e.assistantYN&&e.userKey==loginKey||wi&&e.userKey==loginKey&&"N"==e.assistantYN)&&(authorities=await ri.userAuthorityForMeeting(meetingKey),$i());Pi(Object.values(Ti))}t()}))}(t)}))}}}),U.subscribe({url:"/room/"+meetingKey+"/userKey/"+loginKey,receiver:async e=>{var t;(t=JSON.parse(e.body)).msgType,t.data,"FORBIDDEN"!=t.resultCode?"ERROR"!=t.resultCode?"CONFLICT"==t.resultCode&&y.info({msg:t.msg}):y.info({msg:"해당 기능을 처리할 수 없습니다.<br>잠시 후 다시 시도해 주세요."}):y.info({msg:"해당 기능을 요청할 권한이 없습니다."})}}),U.sendJoinMsg(),window.onoffline=()=>{U.disconnect()},e()})).disconnected((async()=>{await(async()=>{try{return(await fetch("/api/common/server-status")).ok}catch(e){return!1}})()||await y.info({msg:"서버와의 연결이 끊어졌습니다. 재로그인 해 주십시오.",singleton:!0}).then((()=>{Di("/login")})),U.connect()})).connect()})))()}catch(e){qi(e)}finally{y.endLoading()}})()})();